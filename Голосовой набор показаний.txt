// –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç "–ì–æ–ª–æ—Å–æ–≤–æ–π –Ω–∞–±–æ—Ä –ø–æ–∫–∞–∑–∞–Ω–∏–π.txt"
(() => {
  'use strict';

  // ===== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ =====
  const configKey = 'voice_fill_settings';
  const saved = JSON.parse(localStorage.getItem(configKey) || '{}');
  let HOTKEY = saved.HOTKEY ?? 'F2';

  // ===== –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–µ–∫—Ü–∏–∏ –≤ –æ–±—â–µ–π –ø–∞–Ω–µ–ª–∏ =====
  // –ñ–¥–µ–º, –ø–æ–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω
  function waitForManager() {
    return new Promise((resolve) => {
      if (window.meterScriptsPanelManager) {
        resolve();
        return;
      }
      const checkInterval = setInterval(() => {
        if (window.meterScriptsPanelManager) {
          clearInterval(checkInterval);
          resolve();
        }
      }, 100);
      // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
      setTimeout(() => {
        clearInterval(checkInterval);
        if (!window.meterScriptsPanelManager) {
          console.error('–ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±—â–µ–π –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç "–ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±—â–µ–π –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫.txt" –∑–∞–≥—Ä—É–∂–µ–Ω –ø–µ—Ä–≤—ã–º.');
        }
        resolve();
      }, 5000);
    });
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–µ–∫—Ü–∏–∏ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞)
  function registerVoiceSection() {
    if (!window.meterScriptsPanelManager) {
      console.error('–ú–µ–Ω–µ–¥–∂–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
      return;
    }

    if (typeof window.meterScriptsPanelManager.registerSection !== 'function') {
      console.error('–ú–µ—Ç–æ–¥ registerSection –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –º–µ–Ω–µ–¥–∂–µ—Ä–µ');
      return;
    }

    const sectionHtml = `
      <div style="display:flex; gap:4px; align-items:center;">
        <input id="hotkeyInputVoice" value="${HOTKEY}" style="flex:1; padding:3px; min-width:50px;" readonly>
        <button id="setHotkeyBtnVoice" style="flex:none; padding:3px 6px; white-space:nowrap;">–ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
      </div>
    `;

    try {
      window.meterScriptsPanelManager.registerSection('voice', '–ì–æ–ª–æ—Å–æ–≤–æ–π –Ω–∞–±–æ—Ä –ø–æ–∫–∞–∑–∞–Ω–∏–π', sectionHtml, {
        onRender: (container) => {
          const hotkeyInput = container.querySelector('#hotkeyInputVoice');
          const setHotkeyBtn = container.querySelector('#setHotkeyBtnVoice');

          if (!hotkeyInput || !setHotkeyBtn) {
            console.error('–≠–ª–µ–º–µ–Ω—Ç—ã –ø–∞–Ω–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
            return;
          }

          // ===== –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ =====
          function saveAndReload() {
            localStorage.setItem(configKey, JSON.stringify({ HOTKEY }));
            location.reload();
          }

          // ===== –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥–æ—Ä—è—á–µ–π –∫–ª–∞–≤–∏—à–∏ =====
          let waitingHotkey = false;
          setHotkeyBtn.addEventListener('click', () => {
            if (waitingHotkey) return;
            waitingHotkey = true;
            setHotkeyBtn.textContent = '–ù–∞–∂–º–∏—Ç–µ –∫–ª–∞–≤–∏—à—É...';
            setHotkeyBtn.style.background = '#ffd966';

            function captureKey(e) {
              e.preventDefault();
              HOTKEY = e.key;
              hotkeyInput.value = HOTKEY;
              setHotkeyBtn.textContent = '–ù–∞–∑–Ω–∞—á–∏—Ç—å';
              setHotkeyBtn.style.background = '';
              waitingHotkey = false;
              document.removeEventListener('keydown', captureKey);
              saveAndReload();
            }

            document.addEventListener('keydown', captureKey);
          });
        }
      });
      console.log('–°–µ–∫—Ü–∏—è "–ì–æ–ª–æ—Å–æ–≤–æ–π –Ω–∞–±–æ—Ä –ø–æ–∫–∞–∑–∞–Ω–∏–π" —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞');
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–µ–∫—Ü–∏–∏:', error);
    }
  }

  // –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ DOM –∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
  function initRegistration() {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        waitForManager().then(() => {
          // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
          setTimeout(() => {
            registerVoiceSection();
          }, 100);
        });
      });
    } else {
      // DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
      waitForManager().then(() => {
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
        setTimeout(() => {
          registerVoiceSection();
        }, 100);
      });
    }
  }

  initRegistration();

  // ===== –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è =====
  const finalizeDelay = 1000;
  const daySelector = 'input#current_value_1';
  const nightSelector = 'input#current_value_2';

  const russianNumbers = {
    '–Ω–æ–ª—å': 0,
    '–æ–¥–∏–Ω': 1,
    '–¥–≤–∞': 2,
    '—Ç—Ä–∏': 3,
    '—á–µ—Ç—ã—Ä–µ': 4,
    '–ø—è—Ç—å': 5,
    '—à–µ—Å—Ç—å': 6,
    '—Å–µ–º—å': 7,
    '–≤–æ—Å–µ–º—å': 8,
    '–¥–µ–≤—è—Ç—å': 9
  };

  // –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —á–∏—Å–µ–ª –æ—Ç 0 –¥–æ 99 (–≤–∫–ª—é—á–∞—è –ø–æ—Ä—è–¥–∫–æ–≤—ã–µ —á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ)
  const russianYearNumbers = {
    // 0-9
    '–Ω–æ–ª—å': 0, '–Ω—É–ª–µ–≤–æ–π': 0,
    '–æ–¥–∏–Ω': 1, '–ø–µ—Ä–≤—ã–π': 1,
    '–¥–≤–∞': 2, '–≤—Ç–æ—Ä–æ–π': 2,
    '—Ç—Ä–∏': 3, '—Ç—Ä–µ—Ç–∏–π': 3,
    '—á–µ—Ç—ã—Ä–µ': 4, '—á–µ—Ç–≤–µ—Ä—Ç—ã–π': 4,
    '–ø—è—Ç—å': 5, '–ø—è—Ç—ã–π': 5,
    '—à–µ—Å—Ç—å': 6, '—à–µ—Å—Ç–æ–π': 6,
    '—Å–µ–º—å': 7, '—Å–µ–¥—å–º–æ–π': 7,
    '–≤–æ—Å–µ–º—å': 8, '–≤–æ—Å—å–º–æ–π': 8,
    '–¥–µ–≤—è—Ç—å': 9, '–¥–µ–≤—è—Ç—ã–π': 9,
    // 10-19
    '–¥–µ—Å—è—Ç—å': 10, '–¥–µ—Å—è—Ç—ã–π': 10,
    '–æ–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç—å': 11, '–æ–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç—ã–π': 11,
    '–¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—å': 12, '–¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—ã–π': 12,
    '—Ç—Ä–∏–Ω–∞–¥—Ü–∞—Ç—å': 13, '—Ç—Ä–∏–Ω–∞–¥—Ü–∞—Ç—ã–π': 13,
    '—á–µ—Ç—ã—Ä–Ω–∞–¥—Ü–∞—Ç—å': 14, '—á–µ—Ç—ã—Ä–Ω–∞–¥—Ü–∞—Ç—ã–π': 14,
    '–ø—è—Ç–Ω–∞–¥—Ü–∞—Ç—å': 15, '–ø—è—Ç–Ω–∞–¥—Ü–∞—Ç—ã–π': 15,
    '—à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç—å': 16, '—à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç—ã–π': 16,
    '—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å': 17, '—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—ã–π': 17,
    '–≤–æ—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å': 18, '–≤–æ—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—ã–π': 18,
    '–¥–µ–≤—è—Ç–Ω–∞–¥—Ü–∞—Ç—å': 19, '–¥–µ–≤—è—Ç–Ω–∞–¥—Ü–∞—Ç—ã–π': 19,
    // 20-29
    '–¥–≤–∞–¥—Ü–∞—Ç—å': 20, '–¥–≤–∞–¥—Ü–∞—Ç—ã–π': 20,
    '–¥–≤–∞–¥—Ü–∞—Ç—å –æ–¥–∏–Ω': 21, '–¥–≤–∞–¥—Ü–∞—Ç—å –ø–µ—Ä–≤—ã–π': 21,
    '–¥–≤–∞–¥—Ü–∞—Ç—å –¥–≤–∞': 22, '–¥–≤–∞–¥—Ü–∞—Ç—å –≤—Ç–æ—Ä–æ–π': 22,
    '–¥–≤–∞–¥—Ü–∞—Ç—å —Ç—Ä–∏': 23, '–¥–≤–∞–¥—Ü–∞—Ç—å —Ç—Ä–µ—Ç–∏–π': 23,
    '–¥–≤–∞–¥—Ü–∞—Ç—å —á–µ—Ç—ã—Ä–µ': 24, '–¥–≤–∞–¥—Ü–∞—Ç—å —á–µ—Ç–≤–µ—Ä—Ç—ã–π': 24,
    '–¥–≤–∞–¥—Ü–∞—Ç—å –ø—è—Ç—å': 25, '–¥–≤–∞–¥—Ü–∞—Ç—å –ø—è—Ç—ã–π': 25,
    '–¥–≤–∞–¥—Ü–∞—Ç—å —à–µ—Å—Ç—å': 26, '–¥–≤–∞–¥—Ü–∞—Ç—å —à–µ—Å—Ç–æ–π': 26,
    '–¥–≤–∞–¥—Ü–∞—Ç—å —Å–µ–º—å': 27, '–¥–≤–∞–¥—Ü–∞—Ç—å —Å–µ–¥—å–º–æ–π': 27,
    '–¥–≤–∞–¥—Ü–∞—Ç—å –≤–æ—Å–µ–º—å': 28, '–¥–≤–∞–¥—Ü–∞—Ç—å –≤–æ—Å—å–º–æ–π': 28,
    '–¥–≤–∞–¥—Ü–∞—Ç—å –¥–µ–≤—è—Ç—å': 29, '–¥–≤–∞–¥—Ü–∞—Ç—å –¥–µ–≤—è—Ç—ã–π': 29,
    // 30-39
    '—Ç—Ä–∏–¥—Ü–∞—Ç—å': 30, '—Ç—Ä–∏–¥—Ü–∞—Ç—ã–π': 30,
    '—Ç—Ä–∏–¥—Ü–∞—Ç—å –æ–¥–∏–Ω': 31, '—Ç—Ä–∏–¥—Ü–∞—Ç—å –ø–µ—Ä–≤—ã–π': 31,
    '—Ç—Ä–∏–¥—Ü–∞—Ç—å –¥–≤–∞': 32, '—Ç—Ä–∏–¥—Ü–∞—Ç—å –≤—Ç–æ—Ä–æ–π': 32,
    '—Ç—Ä–∏–¥—Ü–∞—Ç—å —Ç—Ä–∏': 33, '—Ç—Ä–∏–¥—Ü–∞—Ç—å —Ç—Ä–µ—Ç–∏–π': 33,
    '—Ç—Ä–∏–¥—Ü–∞—Ç—å —á–µ—Ç—ã—Ä–µ': 34, '—Ç—Ä–∏–¥—Ü–∞—Ç—å —á–µ—Ç–≤–µ—Ä—Ç—ã–π': 34,
    '—Ç—Ä–∏–¥—Ü–∞—Ç—å –ø—è—Ç—å': 35, '—Ç—Ä–∏–¥—Ü–∞—Ç—å –ø—è—Ç—ã–π': 35,
    '—Ç—Ä–∏–¥—Ü–∞—Ç—å —à–µ—Å—Ç—å': 36, '—Ç—Ä–∏–¥—Ü–∞—Ç—å —à–µ—Å—Ç–æ–π': 36,
    '—Ç—Ä–∏–¥—Ü–∞—Ç—å —Å–µ–º—å': 37, '—Ç—Ä–∏–¥—Ü–∞—Ç—å —Å–µ–¥—å–º–æ–π': 37,
    '—Ç—Ä–∏–¥—Ü–∞—Ç—å –≤–æ—Å–µ–º—å': 38, '—Ç—Ä–∏–¥—Ü–∞—Ç—å –≤–æ—Å—å–º–æ–π': 38,
    '—Ç—Ä–∏–¥—Ü–∞—Ç—å –¥–µ–≤—è—Ç—å': 39, '—Ç—Ä–∏–¥—Ü–∞—Ç—å –¥–µ–≤—è—Ç—ã–π': 39,
    // 40-49
    '—Å–æ—Ä–æ–∫': 40, '—Å–æ—Ä–æ–∫–æ–≤–æ–π': 40,
    '—Å–æ—Ä–æ–∫ –æ–¥–∏–Ω': 41, '—Å–æ—Ä–æ–∫ –ø–µ—Ä–≤—ã–π': 41,
    '—Å–æ—Ä–æ–∫ –¥–≤–∞': 42, '—Å–æ—Ä–æ–∫ –≤—Ç–æ—Ä–æ–π': 42,
    '—Å–æ—Ä–æ–∫ —Ç—Ä–∏': 43, '—Å–æ—Ä–æ–∫ —Ç—Ä–µ—Ç–∏–π': 43,
    '—Å–æ—Ä–æ–∫ —á–µ—Ç—ã—Ä–µ': 44, '—Å–æ—Ä–æ–∫ —á–µ—Ç–≤–µ—Ä—Ç—ã–π': 44,
    '—Å–æ—Ä–æ–∫ –ø—è—Ç—å': 45, '—Å–æ—Ä–æ–∫ –ø—è—Ç—ã–π': 45,
    '—Å–æ—Ä–æ–∫ —à–µ—Å—Ç—å': 46, '—Å–æ—Ä–æ–∫ —à–µ—Å—Ç–æ–π': 46,
    '—Å–æ—Ä–æ–∫ —Å–µ–º—å': 47, '—Å–æ—Ä–æ–∫ —Å–µ–¥—å–º–æ–π': 47,
    '—Å–æ—Ä–æ–∫ –≤–æ—Å–µ–º—å': 48, '—Å–æ—Ä–æ–∫ –≤–æ—Å—å–º–æ–π': 48,
    '—Å–æ—Ä–æ–∫ –¥–µ–≤—è—Ç—å': 49, '—Å–æ—Ä–æ–∫ –¥–µ–≤—è—Ç—ã–π': 49,
    // 50-59
    '–ø—è—Ç—å–¥–µ—Å—è—Ç': 50, '–ø—è—Ç–∏–¥–µ—Å—è—Ç—ã–π': 50,
    '–ø—è—Ç—å–¥–µ—Å—è—Ç –æ–¥–∏–Ω': 51, '–ø—è—Ç—å–¥–µ—Å—è—Ç –ø–µ—Ä–≤—ã–π': 51,
    '–ø—è—Ç—å–¥–µ—Å—è—Ç –¥–≤–∞': 52, '–ø—è—Ç—å–¥–µ—Å—è—Ç –≤—Ç–æ—Ä–æ–π': 52,
    '–ø—è—Ç—å–¥–µ—Å—è—Ç —Ç—Ä–∏': 53, '–ø—è—Ç—å–¥–µ—Å—è—Ç —Ç—Ä–µ—Ç–∏–π': 53,
    '–ø—è—Ç—å–¥–µ—Å—è—Ç —á–µ—Ç—ã—Ä–µ': 54, '–ø—è—Ç—å–¥–µ—Å—è—Ç —á–µ—Ç–≤–µ—Ä—Ç—ã–π': 54,
    '–ø—è—Ç—å–¥–µ—Å—è—Ç –ø—è—Ç—å': 55, '–ø—è—Ç—å–¥–µ—Å—è—Ç –ø—è—Ç—ã–π': 55,
    '–ø—è—Ç—å–¥–µ—Å—è—Ç —à–µ—Å—Ç—å': 56, '–ø—è—Ç—å–¥–µ—Å—è—Ç —à–µ—Å—Ç–æ–π': 56,
    '–ø—è—Ç—å–¥–µ—Å—è—Ç —Å–µ–º—å': 57, '–ø—è—Ç—å–¥–µ—Å—è—Ç —Å–µ–¥—å–º–æ–π': 57,
    '–ø—è—Ç—å–¥–µ—Å—è—Ç –≤–æ—Å–µ–º—å': 58, '–ø—è—Ç—å–¥–µ—Å—è—Ç –≤–æ—Å—å–º–æ–π': 58,
    '–ø—è—Ç—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—å': 59, '–ø—è—Ç—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—ã–π': 59,
    // 60-69
    '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç': 60, '—à–µ—Å—Ç–∏–¥–µ—Å—è—Ç—ã–π': 60,
    '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç –æ–¥–∏–Ω': 61, '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç –ø–µ—Ä–≤—ã–π': 61,
    '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç –¥–≤–∞': 62, '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç –≤—Ç–æ—Ä–æ–π': 62,
    '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç —Ç—Ä–∏': 63, '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç —Ç—Ä–µ—Ç–∏–π': 63,
    '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç —á–µ—Ç—ã—Ä–µ': 64, '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç —á–µ—Ç–≤–µ—Ä—Ç—ã–π': 64,
    '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç –ø—è—Ç—å': 65, '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç –ø—è—Ç—ã–π': 65,
    '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç —à–µ—Å—Ç—å': 66, '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç —à–µ—Å—Ç–æ–π': 66,
    '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç —Å–µ–º—å': 67, '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç —Å–µ–¥—å–º–æ–π': 67,
    '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç –≤–æ—Å–µ–º—å': 68, '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç –≤–æ—Å—å–º–æ–π': 68,
    '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—å': 69, '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—ã–π': 69,
    // 70-79
    '—Å–µ–º—å–¥–µ—Å—è—Ç': 70, '—Å–µ–º–∏–¥–µ—Å—è—Ç—ã–π': 70,
    '—Å–µ–º—å–¥–µ—Å—è—Ç –æ–¥–∏–Ω': 71, '—Å–µ–º—å–¥–µ—Å—è—Ç –ø–µ—Ä–≤—ã–π': 71,
    '—Å–µ–º—å–¥–µ—Å—è—Ç –¥–≤–∞': 72, '—Å–µ–º—å–¥–µ—Å—è—Ç –≤—Ç–æ—Ä–æ–π': 72,
    '—Å–µ–º—å–¥–µ—Å—è—Ç —Ç—Ä–∏': 73, '—Å–µ–º—å–¥–µ—Å—è—Ç —Ç—Ä–µ—Ç–∏–π': 73,
    '—Å–µ–º—å–¥–µ—Å—è—Ç —á–µ—Ç—ã—Ä–µ': 74, '—Å–µ–º—å–¥–µ—Å—è—Ç —á–µ—Ç–≤–µ—Ä—Ç—ã–π': 74,
    '—Å–µ–º—å–¥–µ—Å—è—Ç –ø—è—Ç—å': 75, '—Å–µ–º—å–¥–µ—Å—è—Ç –ø—è—Ç—ã–π': 75,
    '—Å–µ–º—å–¥–µ—Å—è—Ç —à–µ—Å—Ç—å': 76, '—Å–µ–º—å–¥–µ—Å—è—Ç —à–µ—Å—Ç–æ–π': 76,
    '—Å–µ–º—å–¥–µ—Å—è—Ç —Å–µ–º—å': 77, '—Å–µ–º—å–¥–µ—Å—è—Ç —Å–µ–¥—å–º–æ–π': 77,
    '—Å–µ–º—å–¥–µ—Å—è—Ç –≤–æ—Å–µ–º—å': 78, '—Å–µ–º—å–¥–µ—Å—è—Ç –≤–æ—Å—å–º–æ–π': 78,
    '—Å–µ–º—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—å': 79, '—Å–µ–º—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—ã–π': 79,
    // 80-89
    '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç': 80, '–≤–æ—Å—å–º–∏–¥–µ—Å—è—Ç—ã–π': 80,
    '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –æ–¥–∏–Ω': 81, '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –ø–µ—Ä–≤—ã–π': 81,
    '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –¥–≤–∞': 82, '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –≤—Ç–æ—Ä–æ–π': 82,
    '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç —Ç—Ä–∏': 83, '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç —Ç—Ä–µ—Ç–∏–π': 83,
    '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç —á–µ—Ç—ã—Ä–µ': 84, '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç —á–µ—Ç–≤–µ—Ä—Ç—ã–π': 84,
    '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –ø—è—Ç—å': 85, '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –ø—è—Ç—ã–π': 85,
    '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç —à–µ—Å—Ç—å': 86, '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç —à–µ—Å—Ç–æ–π': 86,
    '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç —Å–µ–º—å': 87, '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç —Å–µ–¥—å–º–æ–π': 87,
    '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –≤–æ—Å–µ–º—å': 88, '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –≤–æ—Å—å–º–æ–π': 88,
    '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—å': 89, '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—ã–π': 89,
    // 90-99
    '–¥–µ–≤—è–Ω–æ—Å—Ç–æ': 90, '–¥–µ–≤—è–Ω–æ—Å—Ç—ã–π': 90,
    '–¥–µ–≤—è–Ω–æ—Å—Ç–æ –æ–¥–∏–Ω': 91, '–¥–µ–≤—è–Ω–æ—Å—Ç–æ –ø–µ—Ä–≤—ã–π': 91,
    '–¥–µ–≤—è–Ω–æ—Å—Ç–æ –¥–≤–∞': 92, '–¥–µ–≤—è–Ω–æ—Å—Ç–æ –≤—Ç–æ—Ä–æ–π': 92,
    '–¥–µ–≤—è–Ω–æ—Å—Ç–æ —Ç—Ä–∏': 93, '–¥–µ–≤—è–Ω–æ—Å—Ç–æ —Ç—Ä–µ—Ç–∏–π': 93,
    '–¥–µ–≤—è–Ω–æ—Å—Ç–æ —á–µ—Ç—ã—Ä–µ': 94, '–¥–µ–≤—è–Ω–æ—Å—Ç–æ —á–µ—Ç–≤–µ—Ä—Ç—ã–π': 94,
    '–¥–µ–≤—è–Ω–æ—Å—Ç–æ –ø—è—Ç—å': 95, '–¥–µ–≤—è–Ω–æ—Å—Ç–æ –ø—è—Ç—ã–π': 95,
    '–¥–µ–≤—è–Ω–æ—Å—Ç–æ —à–µ—Å—Ç—å': 96, '–¥–µ–≤—è–Ω–æ—Å—Ç–æ —à–µ—Å—Ç–æ–π': 96,
    '–¥–µ–≤—è–Ω–æ—Å—Ç–æ —Å–µ–º—å': 97, '–¥–µ–≤—è–Ω–æ—Å—Ç–æ —Å–µ–¥—å–º–æ–π': 97,
    '–¥–µ–≤—è–Ω–æ—Å—Ç–æ –≤–æ—Å–µ–º—å': 98, '–¥–µ–≤—è–Ω–æ—Å—Ç–æ –≤–æ—Å—å–º–æ–π': 98,
    '–¥–µ–≤—è–Ω–æ—Å—Ç–æ –¥–µ–≤—è—Ç—å': 99, '–¥–µ–≤—è–Ω–æ—Å—Ç–æ –¥–µ–≤—è—Ç—ã–π': 99
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≥–æ–¥–∞ –∏–∑ —Å–ª–æ–≤–µ—Å–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è
  function parseYearFromText(text) {
    // –£–±–∏—Ä–∞–µ–º —Å–ª–æ–≤–æ "–≤—ã–ø—É—Å–∫" –∏ –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã
    let yearText = text.replace(/^–≤—ã–ø—É—Å–∫\s+/i, '').trim().replace(/\s+/g, ' ');
    
    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á–∏—Å–ª–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
    const numericMatch = yearText.match(/^(\d{4}|\d{2})$/);
    if (numericMatch) {
      return numericMatch[1];
    }

    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: –µ—Å–ª–∏ –ø–æ—Å–ª–µ "–≤—ã–ø—É—Å–∫" –∏–¥–µ—Ç –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞ (0-9), –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º –∫–∞–∫ 200X
    const singleDigitMatch = yearText.match(/^(\d)$/);
    if (singleDigitMatch) {
      const digit = parseInt(singleDigitMatch[1], 10);
      const result = `200${digit}`;
      return result;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º "–¥–≤–µ —Ç—ã—Å—è—á–∏" + —á–∏—Å–ª–æ
    const twoThousandMatch = yearText.match(/^–¥–≤–µ\s+—Ç—ã—Å—è—á–∏\s+(.+)$/i);
    if (twoThousandMatch) {
      const numberPart = twoThousandMatch[1].trim().replace(/\s+/g, ' ');
      // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (—Å –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –∏ –±–µ–∑)
      if (russianYearNumbers[numberPart] !== undefined) {
        const yearNum = russianYearNumbers[numberPart];
        const result = `20${yearNum.toString().padStart(2, '0')}`;
        return result;
      }
      
      // –£–±–∏—Ä–∞–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ—Ä—è–¥–∫–æ–≤—ã—Ö —á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö (—ã–π, –æ–π, –∏–π) –∏ –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
      const normalizedNumber = numberPart.replace(/(—ã–π|–æ–π|–∏–π)$/i, '').trim();
      if (normalizedNumber && russianYearNumbers[normalizedNumber] !== undefined) {
        const yearNum = russianYearNumbers[normalizedNumber];
        const result = `20${yearNum.toString().padStart(2, '0')}`;
        return result;
      }
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ (–±–µ–∑ "–¥–≤–µ —Ç—ã—Å—è—á–∏")
    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (—Å –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –∏ –±–µ–∑)
    if (russianYearNumbers[yearText] !== undefined) {
      const yearNum = russianYearNumbers[yearText];
      let result;
      // –ï—Å–ª–∏ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 9, –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º –∫–∞–∫ 200X
      if (yearNum >= 0 && yearNum <= 9) {
        result = `200${yearNum}`;
        return result;
      }
      // –ï—Å–ª–∏ —á–∏—Å–ª–æ <= 30, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º 2000-2030, –∏–Ω–∞—á–µ 1931-1999
      if (yearNum <= 30) {
        result = `20${yearNum.toString().padStart(2, '0')}`;
      } else {
        result = `19${yearNum.toString().padStart(2, '0')}`;
      }
      return result;
    }
    
    // –£–±–∏—Ä–∞–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ—Ä—è–¥–∫–æ–≤—ã—Ö —á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∏ –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
    const normalizedText = yearText.replace(/(—ã–π|–æ–π|–∏–π)$/i, '').trim();
    if (normalizedText && russianYearNumbers[normalizedText] !== undefined) {
      const yearNum = russianYearNumbers[normalizedText];
      let result;
      // –ï—Å–ª–∏ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 9, –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º –∫–∞–∫ 200X
      if (yearNum >= 0 && yearNum <= 9) {
        result = `200${yearNum}`;
        return result;
      }
      if (yearNum <= 30) {
        result = `20${yearNum.toString().padStart(2, '0')}`;
      } else {
        result = `19${yearNum.toString().padStart(2, '0')}`;
      }
      return result;
    }

    return null;
  }

  let recognition;
  if ('webkitSpeechRecognition' in window) recognition = new webkitSpeechRecognition();
  else if ('SpeechRecognition' in window) recognition = new SpeechRecognition();
  else { alert('‚ùå –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ.\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ Google Chrome.'); return; }

  recognition.lang = 'ru-RU';
  recognition.interimResults = true;
  recognition.continuous = true;

  let isRecording = false;
  let transcriptTotal = '';
  let finalizeTimer = null;
  let isDualTariff = false;
  let lastDetectedTariff = null;
  let micOverlay = null;
  let nextIsDay = true;

  function createMicOverlay() {
    if (micOverlay) return micOverlay;
    const overlay = document.createElement('div');
    Object.assign(overlay.style, {
      position: 'fixed',
      inset: '0',
      background: 'rgba(0,0,0,0.4)',
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      zIndex: '9998',
      opacity: '0',
      transition: 'opacity 0.2s ease',
    });
    const mic = document.createElement('div');
    mic.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="100" height="100"><path d="M12 14a3 3 0 0 0 3-3V5a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 14 0h-2z"/></svg>`;
    mic.style.filter = 'drop-shadow(0 0 10px rgba(255,255,255,0.6))';
    mic.style.transform = 'scale(1)';
    mic.style.transition = 'transform 0.3s ease-in-out';
    overlay.appendChild(mic);

    overlay.animateMic = () => { mic.style.transform = 'scale(1.15)'; setTimeout(()=>mic.style.transform='scale(1)',300); };
    overlay.show = () => overlay.style.opacity='1';
    overlay.hide = () => { overlay.style.opacity='0'; setTimeout(()=>overlay.remove(),300); micOverlay=null; };

    document.body.appendChild(overlay);
    micOverlay = overlay;
    return overlay;
  }

  function showToast(text,time=7000,color='#333'){
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ DOM –∑–∞–≥—Ä—É–∂–µ–Ω
    if (!document.body) {
      // –ï—Å–ª–∏ body –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∂–¥–µ–º –µ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => showToast(text, time, color));
        return;
      }
      // –ï—Å–ª–∏ body –≤—Å–µ –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥–∏–º
      return;
    }
    
    // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö toast-—Å–æ–æ–±—â–µ–Ω–∏–π
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
      toastContainer = document.createElement('div');
      toastContainer.id = 'toast-container';
      Object.assign(toastContainer.style, {
        position: 'fixed',
        bottom: '20px',
        right: '20px',
        zIndex: '9999',
        display: 'flex',
        flexDirection: 'column',
        gap: '10px',
        pointerEvents: 'none',
        alignItems: 'flex-end'
      });
      document.body.appendChild(toastContainer);
    }

    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    const toast = document.createElement('div');
    toast.textContent = text;
    Object.assign(toast.style, {
      background: color,
      color: '#fff',
      padding: '10px 20px',
      borderRadius: '10px',
      fontSize: '14px',
      opacity: '0',
      pointerEvents: 'none',
      transition: 'opacity 0.3s ease, transform 0.3s ease',
      transform: 'translateY(10px)',
      whiteSpace: 'normal',
      maxWidth: '400px',
      wordWrap: 'break-word'
    });

    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    toastContainer.appendChild(toast);

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
    setTimeout(() => {
      toast.style.opacity = '0.95';
      toast.style.transform = 'translateY(0)';
    }, 10);

    // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
    setTimeout(() => {
      toast.style.opacity = '0';
      toast.style.transform = 'translateY(-10px)';
      setTimeout(() => {
        if (toast.parentNode) {
          toast.remove();
        }
        // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—É—Å—Ç, —É–¥–∞–ª—è–µ–º –µ–≥–æ
        if (toastContainer.children.length === 0) {
          toastContainer.remove();
        }
      }, 300);
    }, time);
  }

  function detectTariffMode(silent=false){
    const hasDay=!!document.querySelector(daySelector);
    const hasNight=!!document.querySelector(nightSelector);
    const dual = hasDay && hasNight;
    if(dual !== lastDetectedTariff){
      lastDetectedTariff=dual;
      isDualTariff=dual;
      if(!silent) showToast(dual?'‚öôÔ∏è –î–≤—É—Ö—Ç–∞—Ä–∏—Ñ–Ω—ã–π —Ä–µ–∂–∏–º':'‚öôÔ∏è –û–¥–Ω–æ—Ç–∞—Ä–∏—Ñ–Ω—ã–π —Ä–µ–∂–∏–º',2500,'#555');
      nextIsDay=true;
    }
  }
  // –í—ã–∑—ã–≤–∞–µ–º detectTariffMode —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
  if (document.body) {
    detectTariffMode();
  } else if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => detectTariffMode());
  }

  async function setReactInputValue(selector,value){
    const input=document.querySelector(selector);
    if(!input) return false;
    const lastValue=input.value;
    input.value=value;
    const tracker=input._valueTracker;
    if(tracker){ try{tracker.setValue(lastValue);}catch(e){} }
    input.dispatchEvent(new Event('input',{bubbles:true}));
    input.dispatchEvent(new Event('change',{bubbles:true}));
    input.dispatchEvent(new Event('blur',{bubbles:true}));
    await new Promise(r=>setTimeout(r,150));
    return true;
  }

  async function changeSelect(container, optionText) {
    if (!container) {
      return false;
    }

    // –°–∏–º—É–ª–∏—Ä—É–µ–º –∫–ª–∏–∫ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥—Ä–æ–ø–¥–∞—É–Ω–∞
    container.click();
    await new Promise(r => setTimeout(r, 600)); // –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç

    // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
    let panel = null;
    for (let i = 0; i < 15; i++) {
      await new Promise(r => setTimeout(r, 100));
      panel = document.querySelector('._panel_1i7mm_19.slide-up-enter-done');
      if (!panel) {
        panel = document.querySelector('._panel_1i7mm_19');
      }
      if (panel) {
        break;
      }
    }
    
    if (!panel) {
      return false;
    }

    // –ò—â–µ–º –æ–ø—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –ø–∞–Ω–µ–ª–∏ - –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤
    let option = null;
    
    // –°–ø–æ—Å–æ–± 1: –∏—â–µ–º –ø–æ –∫–ª–∞—Å—Å—É –∏ –ø–æ–ª–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É
    const options = panel.querySelectorAll('._option_1oihn_78, ._slideOption_1mapt_22');
    option = Array.from(options).find(el => {
      const text = el.textContent.trim();
      return text === optionText;
    });
    
    if (option) {
    } else {
      // –°–ø–æ—Å–æ–± 2: –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –∏—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É –≤ span
      option = Array.from(options).find(el => {
        const span = el.querySelector('span');
        if (span) {
          const spanText = span.textContent.trim();
          return spanText === optionText;
        }
        return false;
      });
      
      if (option) {
      } else {
        // –°–ø–æ—Å–æ–± 3: –∏—â–µ–º span —Å —Ç–µ–∫—Å—Ç–æ–º –∏ –±–µ—Ä–µ–º —Ä–æ–¥–∏—Ç–µ–ª—è
        const spans = panel.querySelectorAll('span');
        const targetSpan = Array.from(spans).find(span => {
          const text = span.textContent.trim();
          return text === optionText;
        });
        if (targetSpan) {
          option = targetSpan.closest('._option_1oihn_78') || targetSpan.closest('._slideOption_1mapt_22') || targetSpan.parentElement;
        }
      }
    }

    if (option) {
      option.click();
      await new Promise(r => setTimeout(r, 300)); // –ñ–¥–µ–º –∑–∞–∫—Ä—ã—Ç–∏—è
      return true;
    } else {
      const allTexts = Array.from(options).map(el => el.textContent.trim());
    }
    return false;
  }

  // –°–ª–æ–≤–∞—Ä—å –∫–æ–¥–æ–≤—ã—Ö —Ñ—Ä–∞–∑ –¥–ª—è —Ç–∏–ø–æ–≤ —Å—á–µ—Ç—á–∏–∫–æ–≤
  const counterTypePhrases = {
    // –°–ï 101 S6 145 M6
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ —ç—Å 6': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ —ç—Å —à–µ—Å—Ç—å': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ —Å—ç 6': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ —Å—ç —à–µ—Å—Ç—å': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ ce 6': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ ce —à–µ—Å—Ç—å': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ s6': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ —ç—Å6': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ —Å—ç6': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ ce6': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ s 6': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ —Å6': '–°–ï 101 S6 145 M6',
    '—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞ —Å 6': '–°–ï 101 S6 145 M6',
    '—ç—Å 6': '–°–ï 101 S6 145 M6',
    '—ç—Å —à–µ—Å—Ç—å': '–°–ï 101 S6 145 M6',
    '—Å—ç 6': '–°–ï 101 S6 145 M6',
    '—Å—ç —à–µ—Å—Ç—å': '–°–ï 101 S6 145 M6',
    'ce 6': '–°–ï 101 S6 145 M6',
    'ce —à–µ—Å—Ç—å': '–°–ï 101 S6 145 M6',
    's6': '–°–ï 101 S6 145 M6',
    's 6': '–°–ï 101 S6 145 M6',
    '—ç—Å6': '–°–ï 101 S6 145 M6',
    '—Å—ç6': '–°–ï 101 S6 145 M6',
    'ce6': '–°–ï 101 S6 145 M6',
    '—Å6': '–°–ï 101 S6 145 M6',
    '—Å 6': '–°–ï 101 S6 145 M6',
  };

  function showCounterTypeChoice() {
    return new Promise((resolve) => {
      // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 1000000;
        display: flex;
        justify-content: center;
        align-items: center;
      `;
      
      const modalContent = document.createElement('div');
      modalContent.style.cssText = `
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        font-family: sans-serif;
        min-width: 300px;
        max-width: 500px;
      `;
      
      modalContent.innerHTML = `
        <h3 style="margin-top:0; margin-bottom:20px; text-align:center; font-size:18px;">
          –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å—á–µ—Ç—á–∏–∫–∞:
        </h3>
        <div style="display:flex; flex-direction:column; gap:12px;">
          <button class="counter-choice-btn" data-type="–°–ï 101 R5 145 M6" 
            style="padding:15px 20px; background:#007acc; color:white; border:none; 
                   border-radius:8px; cursor:pointer; font-size:15px; font-weight:bold;
                   transition:background 0.2s;">
            –°–ï 101 R5 145 M6
          </button>
          <button class="counter-choice-btn" data-type="–°–ï 101 R5.1 145 –ú6" 
            style="padding:15px 20px; background:#007acc; color:white; border:none; 
                   border-radius:8px; cursor:pointer; font-size:15px; font-weight:bold;
                   transition:background 0.2s;">
            –°–ï 101 R5.1 145 –ú6
          </button>
        </div>
      `;
      
      modal.appendChild(modalContent);
      document.body.appendChild(modal);
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
      modalContent.querySelectorAll('.counter-choice-btn').forEach(btn => {
        btn.addEventListener('mouseenter', () => {
          btn.style.background = '#005a9e';
        });
        btn.addEventListener('mouseleave', () => {
          btn.style.background = '#007acc';
        });
        
        btn.addEventListener('click', () => {
          const selectedType = btn.dataset.type;
          modal.remove();
          resolve(selectedType);
        });
      });
      
      // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
          resolve(null);
        }
      });
    });
  }

  async function changeCounterType(counterTypeText) {
    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω–æ
    // –ü–æ–ª–µ –∏–º–µ–µ—Ç id="fact_counter_type" –∏ –∫–ª–∞—Å—Å="_input_gy901_8"
    let factTypeInput = document.querySelector('input#fact_counter_type') ||
                       document.querySelector('input._input_gy901_8[name="fact_counter_type"]') ||
                       document.querySelector('input[name="fact_counter_type"]');
    if (factTypeInput && factTypeInput.offsetParent !== null) {
      // –ü–æ–ª–µ —É–∂–µ –≤–∏–¥–∏–º–æ, –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω—è–µ–º –µ–≥–æ
      await setReactInputValue('input#fact_counter_type', counterTypeText);
      showToast(`‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ç–∏–ø: ${counterTypeText}`, 3000, '#2a7');
      return true;
    }

    // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Å–æ–º _value_8fpl2_13, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
    // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —ç—Ç–∏–º –∫–ª–∞—Å—Å–æ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏—Ö —Ç–µ–∫—Å—Ç
    const allValueElements = document.querySelectorAll('._value_8fpl2_13');
    let complianceValueEl = null;
    
    for (const valueEl of allValueElements) {
      if (valueEl.textContent.trim() === '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
        complianceValueEl = valueEl;
        break;
      }
    }

    if (!complianceValueEl) {
      showToast('‚ùå –°–µ–ª–µ–∫—Ç "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" –Ω–µ –Ω–∞–π–¥–µ–Ω', 3000, '#a33');
      return false;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    if (complianceValueEl.textContent.trim() === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
      // –£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç", –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ
      // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—è (–∏–º–µ–µ—Ç id="fact_counter_type" –∏ –∫–ª–∞—Å—Å="_input_gy901_8")
      factTypeInput = null;
      for (let i = 0; i < 20; i++) {
        await new Promise(r => setTimeout(r, 100));
        factTypeInput = document.querySelector('input#fact_counter_type') ||
                       document.querySelector('input._input_gy901_8[name="fact_counter_type"]') ||
                       document.querySelector('input[name="fact_counter_type"]');
        if (factTypeInput && factTypeInput.offsetParent !== null) break;
      }
      
      if (factTypeInput && factTypeInput.offsetParent !== null) {
        await setReactInputValue('input#fact_counter_type', counterTypeText);
        showToast(`‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ç–∏–ø: ${counterTypeText}`, 3000, '#2a7');
        return true;
      } else {
        showToast('‚ùå –ü–æ–ª–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–∏–ø–∞ –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å', 3000, '#a33');
        return false;
      }
    }

    // –ö–ª–∏–∫–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç _value_8fpl2_13 —Å —Ç–µ–∫—Å—Ç–æ–º "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
    complianceValueEl.click();
    await new Promise(r => setTimeout(r, 400));

    // –ù–∞—Ö–æ–¥–∏–º –ø–∞–Ω–µ–ª—å —Å –æ–ø—Ü–∏—è–º–∏ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
    // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
    let panel = null;
    for (let i = 0; i < 15; i++) {
      await new Promise(r => setTimeout(r, 100));
      panel = document.querySelector('._panel_1q4rd_19.slide-up-enter-done') ||
              document.querySelector('._panel_1q4rd_19') ||
              document.querySelector('._panel_1i7mm_19.slide-up-enter-done') ||
              document.querySelector('._panel_1i7mm_19');
      if (panel) break;
    }
    
    if (!panel) {
      showToast('‚ùå –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 3000, '#a33');
      return false;
    }

    // –ò—â–µ–º –æ–ø—Ü–∏—é "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" —Å –∫–ª–∞—Å—Å–æ–º _option_8fpl2_78
    let notCompliantOption = null;
    
    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ –∫–ª–∞—Å—Å—É _option_8fpl2_78
    const allOptions = panel.querySelectorAll('._option_8fpl2_78, ._option_1oihn_78, [class*="option"]');
    for (const option of allOptions) {
      const span = option.querySelector('span');
      const text = span ? span.textContent.trim() : option.textContent.trim();
      if (text === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
        notCompliantOption = option;
        break;
      }
    }
    
    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ —Ç–µ–∫—Å—Ç—É, –ø—Ä–æ–±—É–µ–º –ø–æ nth-child (–≤—Ç–æ—Ä–∞—è –æ–ø—Ü–∏—è –æ–±—ã—á–Ω–æ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç")
    if (!notCompliantOption) {
      notCompliantOption = panel.querySelector('._option_8fpl2_78:nth-child(2)') ||
                          panel.querySelector('._option_1oihn_78:nth-child(2)');
    }

    if (!notCompliantOption) {
      showToast('‚ùå –û–ø—Ü–∏—è "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 3000, '#a33');
      return false;
    }

    // –ö–ª–∏–∫–∞–µ–º –Ω–∞ –æ–ø—Ü–∏—é "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
    notCompliantOption.click();
    await new Promise(r => setTimeout(r, 400));

    // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–∏–ø–æ–≤ —Å—á–µ—Ç—á–∏–∫–æ–≤ (_panel_1q4rd_19)
    // –≠—Ç–∞ –ø–∞–Ω–µ–ª—å –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ —Å—á–µ—Ç—á–∏–∫–æ–≤
    let typeListPanel = null;
    for (let i = 0; i < 20; i++) {
      await new Promise(r => setTimeout(r, 100));
      // –ò—â–µ–º –ø–∞–Ω–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å –¥–ª–∏–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º)
      const allPanels = document.querySelectorAll('._panel_1q4rd_19.slide-up-enter-done, ._panel_1q4rd_19');
      for (const p of allPanels) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–∞–Ω–µ–ª—å —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–∏–ø–æ–≤ (—Å–æ–¥–µ—Ä–∂–∏—Ç –º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤)
        const panelText = p.textContent.trim();
        if (panelText.length > 50 || panelText.includes('–ú–µ—Ä–∫—É—Ä–∏–π') || panelText.includes('CE') || panelText.includes('STAR')) {
          typeListPanel = p;
          break;
        }
      }
      if (typeListPanel) break;
    }

    // –ï—Å–ª–∏ –ø–∞–Ω–µ–ª—å –ø–æ—è–≤–∏–ª–∞—Å—å, "—Å–∫–∏–ø–∞–µ–º" –µ—ë - –∫–ª–∏–∫–∞–µ–º –≤ –ª—é–±–æ–µ –º–µ—Å—Ç–æ –Ω–∞–¥ –Ω–µ–π –Ω–∞ —Å–∞–π—Ç–µ
    if (typeListPanel) {
      const panelRect = typeListPanel.getBoundingClientRect();
      // –ö–ª–∏–∫–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ –≤—ã—à–µ –ø–∞–Ω–µ–ª–∏ (–Ω–∞ –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ –Ω–∞–¥ –Ω–µ–π)
      const clickX = panelRect.left + panelRect.width / 2;
      const clickY = panelRect.top - 50; // –í—ã—à–µ –ø–∞–Ω–µ–ª–∏
      
      // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç –≤ —ç—Ç–æ–π —Ç–æ—á–∫–µ –∏ –∫–ª–∏–∫–∞–µ–º –Ω–∞ –Ω–µ–≥–æ
      const elementAtPoint = document.elementFromPoint(clickX, clickY);
      if (elementAtPoint && elementAtPoint !== typeListPanel && !typeListPanel.contains(elementAtPoint)) {
        elementAtPoint.click();
      } else {
        // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —ç–ª–µ–º–µ–Ω—Ç, –ø—Ä–æ–±—É–µ–º –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ body –∏–ª–∏ document
        // –≠—Ç–æ –∑–∞–∫—Ä–æ–µ—Ç –ø–∞–Ω–µ–ª—å
        const clickEvent = new MouseEvent('click', {
          bubbles: true,
          cancelable: true,
          view: window,
          clientX: clickX,
          clientY: clickY
        });
        const targetElement = document.elementFromPoint(clickX, clickY);
        if (targetElement && targetElement !== typeListPanel) {
          targetElement.dispatchEvent(clickEvent);
        } else {
          // –í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ –∫–ª–∏–∫–∞–µ–º –Ω–∞ body
          document.body.click();
        }
      }
      await new Promise(r => setTimeout(r, 300));
    }

    // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—è "–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ç–∏–ø –ü–£"
    // –ü–æ–ª–µ –∏–º–µ–µ—Ç id="fact_counter_type" –∏ –∫–ª–∞—Å—Å="_input_gy901_8"
    factTypeInput = null;
    for (let i = 0; i < 30; i++) {
      await new Promise(r => setTimeout(r, 100));
      // –ò—â–µ–º –ø–æ id (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±) –∏–ª–∏ –ø–æ –∫–ª–∞—Å—Å—É (fallback)
      factTypeInput = document.querySelector('input#fact_counter_type') ||
                     document.querySelector('input._input_gy901_8[name="fact_counter_type"]') ||
                     document.querySelector('input[name="fact_counter_type"]');
      if (factTypeInput && factTypeInput.offsetParent !== null) break;
    }

    if (factTypeInput && factTypeInput.offsetParent !== null) {
      await setReactInputValue('input#fact_counter_type', counterTypeText);
      showToast(`‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ç–∏–ø: ${counterTypeText}`, 3000, '#2a7');
      return true;
    } else {
      showToast('‚ùå –ü–æ–ª–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–∏–ø–∞ –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å', 3000, '#a33');
      return false;
    }
  }

  recognition.onresult=event=>{
    let combined='';
    for(let i=0;i<event.results.length;i++) combined+=event.results[i][0].transcript+' ';
    transcriptTotal=combined.trim();
    if(micOverlay) micOverlay.animateMic();
  };

  recognition.onend=()=>{ if(isRecording) recognition.start(); };
  recognition.onerror=event=>{ showToast('–û—à–∏–±–∫–∞ —Ä–µ—á–∏: '+event.error,3000,'#a33'); };

  document.addEventListener('keydown',e=>{
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø–æ key, –∏ –ø–æ code –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ (–¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–ª–∞–≤–∏—à)
    const isHotkey = e.key === HOTKEY || e.code === HOTKEY || 
                     (HOTKEY === 'F2' && (e.key === 'F2' || e.code === 'F2'));
    
    if(isHotkey && !e.ctrlKey && !e.altKey && !e.metaKey && !e.shiftKey){
      if(!isRecording){
        e.preventDefault();
        e.stopPropagation();
        isRecording=true;
        transcriptTotal='';
        recognition.start();
        const overlay=createMicOverlay();
        overlay.show();
        showToast('üé§ –°–ª—É—à–∞—é... –æ—Ç–ø—É—Å—Ç–∏—Ç–µ F2 –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏',2000,'#2a7');
      }
      clearTimeout(finalizeTimer);
    }
  }, true); // –ò—Å–ø–æ–ª—å–∑—É–µ–º capture phase –¥–ª—è –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–µ–≥–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞

  document.addEventListener('keyup',e=>{
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø–æ key, –∏ –ø–æ code –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
    const isHotkey = e.key === HOTKEY || e.code === HOTKEY || 
                     (HOTKEY === 'F2' && (e.key === 'F2' || e.code === 'F2'));
    
    if(isHotkey && isRecording){
      e.preventDefault();
      e.stopPropagation();
      isRecording=false;
      showToast('üïì –û–±—Ä–∞–±–æ—Ç–∫–∞...',1000,'#555');
      if(micOverlay) micOverlay.hide();
      finalizeTimer=setTimeout(async()=>{
        recognition.stop();

        const lowerTranscript = transcriptTotal.toLowerCase();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å—á–µ—Ç—á–∏–∫–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–ª–æ–≤–æ "—Å—á–µ—Ç—á–∏–∫" –∏–ª–∏ "—Å—á—ë—Ç—á–∏–∫")
        if (lowerTranscript.includes('—Å—á–µ—Ç—á–∏–∫') || lowerTranscript.includes('—Å—á—ë—Ç—á–∏–∫')) {
          // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ —Å–ª–æ–≤–∞ "—Å—á–µ—Ç—á–∏–∫" –∏–ª–∏ "—Å—á—ë—Ç—á–∏–∫"
          const counterMatch = lowerTranscript.match(/(?:—Å—á–µ—Ç—á–∏–∫|—Å—á—ë—Ç—á–∏–∫)\s+(.+)/);
          if (!counterMatch) {
            showToast('‚ùå –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω —Ç–∏–ø —Å—á–µ—Ç—á–∏–∫–∞', 3000, '#a33');
            return;
          }

          const counterPhrase = counterMatch[1].trim();
          
          // –£–±–∏—Ä–∞–µ–º —Å–ª–æ–≤–æ "—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
          const phraseWithoutEnergy = counterPhrase.replace(/^—ç–Ω–µ—Ä–≥–æ–º–µ—Ä–∞\s+/i, '').trim();
          
          // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ—Ä–∞–∑—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (—É–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã, –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É)
          // –¢–∞–∫–∂–µ –∑–∞–º–µ–Ω—è–µ–º –∫–∏—Ä–∏–ª–ª–∏—Ü—É –Ω–∞ –ª–∞—Ç–∏–Ω–∏—Ü—É –¥–ª—è —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏: —Ä -> r, —Å -> s
          let normalizedPhrase = phraseWithoutEnergy.replace(/\s+/g, '').toLowerCase();
          normalizedPhrase = normalizedPhrase.replace(/—Ä/g, 'r').replace(/—Å/g, 's');
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ r5 (–≤–∫–ª—é—á–∞—è –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π —Ä5)
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã: r5, —ç—Ä5, —Ä5, r–ø—è—Ç—å, —ç—Ä–ø—è—Ç—å, —Ä–ø—è—Ç—å
          const isR5Simple = normalizedPhrase === 'r5' || normalizedPhrase === '—ç—Ä5' || 
                           normalizedPhrase === 'r–ø—è—Ç—å' || normalizedPhrase === '—ç—Ä–ø—è—Ç—å';
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏: r 5, —ç—Ä 5, —Ä 5, r –ø—è—Ç—å, —ç—Ä –ø—è—Ç—å, —Ä –ø—è—Ç—å
          const normalizedForRegex = phraseWithoutEnergy.toLowerCase().replace(/—Ä/g, 'r');
          const isR5WithSpace = /^(—ç—Ä|r)\s*5\s*$|^(—ç—Ä|r)\s*–ø—è—Ç—å\s*$/i.test(normalizedForRegex);
          
          // –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —ç—Ç–æ r5 (–ª—é–±–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
          const isR5Ambiguous = isR5Simple || isR5WithSpace;
          
          // –ï—Å–ª–∏ —ç—Ç–æ r5 (–ª—é–±–æ–π –≤–∞—Ä–∏–∞–Ω—Ç) - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
          if (isR5Ambiguous) {
            const selectedType = await showCounterTypeChoice();
            if (selectedType) {
              const success = await changeCounterType(selectedType);
              if (!success) {
                showToast('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø —Å—á–µ—Ç—á–∏–∫–∞', 3000, '#a33');
              }
            }
            return;
          }
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ú–µ—Ä–∫—É—Ä–∏–π
          let counterType = null;
          
          // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ—Ä–∞–∑—É: –∑–∞–º–µ–Ω—è–µ–º "–∏" –∏ –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É, —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
          let normalizedForMercury = counterPhrase.toLowerCase()
            .replace(/\s+/g, ' ')
            .replace(/\s*–∏\s*/g, '.')
            .replace(/,/g, '.')  // –ó–∞–ø—è—Ç–∞—è —Ç–æ–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º
            .trim();
          
          // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ú–µ—Ä–∫—É—Ä–∏–π 201.x (201.5, 201.6, 201.7, 201.8)
          // –ú–æ–∂–µ—Ç –±—ã—Ç—å: "201.5", "201 –∏ 5", "201,5", "201 —Ç–æ—á–∫–∞ 5"
          const mercury201Pattern = /^201\s*[\.–∏]\s*([5-8])$/;
          const mercury201Match = normalizedForMercury.match(mercury201Pattern);
          if (mercury201Match) {
            const version = mercury201Match[1];
            counterType = `–ú–µ—Ä–∫—É—Ä–∏–π 201.${version}`;
          }
          
          // –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ú–µ—Ä–∫—É—Ä–∏–π 200.02 (–º–æ–∂–µ—Ç –±—ã—Ç—å "200.02", "200 –∏ 02", "200,02", "200 –∏ 0 2", "200,0 2", "200 –∏ 0,2")
          if (!counterType) {
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è 200.02
            // –ü–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ "200 –∏ 0,2" —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "200.0.2", –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å "0.2" –Ω–∞ "02"
            let normalized200 = normalizedForMercury
              .replace(/\.0\.2/g, '.02')              // "0.2" -> "02" (–ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏)
              .replace(/\.\s*0\s*[,\.]\s*2/g, '.02') // "0,2" –∏–ª–∏ "0.2" —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ -> "02"
              .replace(/\.\s*0\s*2/g, '.02')          // "0 2" -> "02"
              .replace(/\.\s*0\s*0\s*2/g, '.02');     // "0 0 2" -> "02"
            
            const mercury200Pattern = /^200\s*\.\s*0?\s*2$/;
            if (mercury200Pattern.test(normalized200)) {
              counterType = '–ú–µ—Ä–∫—É—Ä–∏–π 200.02';
            }
          }
          
          // –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ú–µ—Ä–∫—É—Ä–∏–π 206 RN (–ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–∞—á–∞–ª–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π)
          // –ú–æ–∂–µ—Ç –±—ã—Ç—å: "206 —Ä –Ω", "206 —ç—Ä —ç–Ω", "206 —Ä —ç–Ω", "206 —ç—Ä –Ω", "206—Ä–Ω", "206—ç—Ä—ç–Ω", "206rn", "206 rn"
          if (!counterType) {
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º: –∑–∞–º–µ–Ω—è–µ–º –∫–∏—Ä–∏–ª–ª–∏—Ü—É —Ä –Ω–∞ r, –Ω –Ω–∞ n, "—ç—Ä" –Ω–∞ "r", "—ç–Ω" –Ω–∞ "n", —É–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã
            let normalizedForRN = counterPhrase.toLowerCase()
              .replace(/—ç—Ä/g, 'r')
              .replace(/—ç–Ω/g, 'n')
              .replace(/—Ä/g, 'r')
              .replace(/–Ω/g, 'n')
              .replace(/\s+/g, '')
              .trim();
            
            // –ü–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: "206rn"
            // –ü—Ä–∏–º–µ—Ä—ã: "206 —ç—Ä —ç–Ω" -> "206 r n" -> "206rn", "206 —Ä –Ω" -> "206 r n" -> "206rn"
            const mercury206RNPattern = /^206rn$/i;
            if (mercury206RNPattern.test(normalizedForRN)) {
              counterType = '–ú–µ—Ä–∫—É—Ä–∏–π 206 RN';
            }
          }
          
          // –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ú–µ—Ä–∫—É—Ä–∏–π 206 N (–ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ RN, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å "206 —Ä –Ω" –∫–∞–∫ "206 –Ω")
          // –ú–æ–∂–µ—Ç –±—ã—Ç—å: "206 –Ω", "206 —ç–Ω", "206–Ω", "206—ç–Ω", "206n", "206 n"
          if (!counterType) {
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º: –∑–∞–º–µ–Ω—è–µ–º –∫–∏—Ä–∏–ª–ª–∏—Ü—É –Ω –Ω–∞ n, "—ç–Ω" –Ω–∞ "n", —É–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã
            let normalizedForN = counterPhrase.toLowerCase()
              .replace(/—ç–Ω/g, 'n')
              .replace(/–Ω/g, 'n')
              .replace(/\s+/g, '')
              .trim();
            
            // –ü–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: "206n"
            const mercury206NPattern = /^206n$/i;
            if (mercury206NPattern.test(normalizedForN)) {
              counterType = '–ú–µ—Ä–∫—É—Ä–∏–π 206 N';
            }
          }
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã –°–ï 101 –∏ CE 102M
          if (!counterType) {
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –¥–ª–∏–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ø–æ—Ç–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ
            // –ü–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω: "—Ü—ç –µ"/"—Ü–µ –µ"/"—Å –µ" -> "ce", "—ç–º" -> "m" –¥–æ –∑–∞–º–µ–Ω—ã "—ç" -> "e"
            let normalizedForCE = counterPhrase.toLowerCase()
              .replace(/-/g, '')            // –°–Ω–∞—á–∞–ª–∞ —É–±–∏—Ä–∞–µ–º —Ç–∏—Ä–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ –≤–º–µ—Å—Ç–æ –ø—Ä–æ–±–µ–ª–∞)
              .replace(/—Ü\s+–µ/g, 'ce')       // "—Ü –µ" -> "ce" (—Å –ø—Ä–æ–±–µ–ª–æ–º –º–µ–∂–¥—É —Ü –∏ –µ)
              .replace(/—Ü—ç\s*–µ/g, 'ce')      // "—Ü—ç –µ" -> "ce"
              .replace(/—Ü–µ\s*–µ/g, 'ce')     // "—Ü–µ –µ" -> "ce"
              .replace(/—Å\s+–µ/g, 'ce')      // "—Å –µ" -> "ce" (—Å –ø—Ä–æ–±–µ–ª–æ–º –º–µ–∂–¥—É —Å –∏ –µ, –µ—Å–ª–∏ "—Ü" —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ –∫–∞–∫ "—Å")
              .replace(/—Å\s*–µ/g, 'ce')      // "—Å –µ" -> "ce" (–µ—Å–ª–∏ "—Ü" —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ –∫–∞–∫ "—Å")
              .replace(/—Ü–µ102/g, 'ce102')   // "—Ü–µ102" -> "ce102" (—Å–ª–∏—Ç–Ω–æ)
              .replace(/—Å–µ102/g, 'ce102')   // "—Å–µ102" -> "ce102" (—Å–ª–∏—Ç–Ω–æ)
              .replace(/—Å–µ/g, 'ce')        // "—Å–µ" -> "ce" (—Å–ª–∏—Ç–Ω–æ–µ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ)
              .replace(/—Ü—ç/g, 'ce')         // "—Ü—ç" -> "ce"
              .replace(/—Ü–µ/g, 'ce')          // "—Ü–µ" -> "ce"
              .replace(/^—Å\s*101/g, 'ce101') // "—Å 101" -> "ce101" (—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π –¥–ª—è –°–ï 101)
              .replace(/^—Å\s*102/g, 'ce102') // "—Å 102" -> "ce102" (—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π –¥–ª—è CE 102)
              .replace(/—ç–º/g, 'm')          // "—ç–º" -> "m"
              .replace(/—ç/g, 'e')            // "—ç" -> "e"
              .replace(/–º/g, 'm')            // "–º" -> "m"
              .replace(/\s+/g, '')
              .trim();
            
            // –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –°–ï 101 (–º–æ–∂–µ—Ç –±—ã—Ç—å "ce101", "ce 101", "—Ü—ç –µ 101", "—Ü–µ101")
            const ce101Pattern = /^ce101$/i;
            if (ce101Pattern.test(normalizedForCE)) {
              counterType = '–°–ï 101';
            }
            
            // –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è CE 102M (–º–æ–∂–µ—Ç –±—ã—Ç—å "ce102m", "ce 102 m", "—Ü–µ 102 —ç–º", "—Ü–µ102–º")
            if (!counterType) {
              const ce102MPattern = /^ce102m$/i;
              if (ce102MPattern.test(normalizedForCE)) {
                counterType = 'CE 102M';
              }
            }
          }
          
          // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –ú–µ—Ä–∫—É—Ä–∏–π –∏–ª–∏ CE, –∏—â–µ–º –≤ —Å–ª–æ–≤–∞—Ä–µ
          if (!counterType) {
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ—Ä–∞–∑—É –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ —Å–ª–æ–≤–∞—Ä–µ (–∑–∞–º–µ–Ω—è–µ–º –∫–∏—Ä–∏–ª–ª–∏—Ü—É –Ω–∞ –ª–∞—Ç–∏–Ω–∏—Ü—É)
            const normalizedForSearch = counterPhrase.toLowerCase()
              .replace(/—Ä/g, 'r')
              .replace(/—Å/g, 's');
            
            // –ò—â–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ —Å–ª–æ–≤–∞—Ä–µ –∫–æ–¥–æ–≤—ã—Ö —Ñ—Ä–∞–∑ (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤)
            for (const [phrase, type] of Object.entries(counterTypePhrases)) {
              // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ñ—Ä–∞–∑—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å r5, —Ç–∞–∫ –∫–∞–∫ –¥–ª—è –Ω–∏—Ö —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤—ã—à–µ
              const normalizedPhrase = phrase.toLowerCase().replace(/—Ä/g, 'r').replace(/—Å/g, 's');
              if (normalizedPhrase.includes('r5') || normalizedPhrase.includes('—ç—Ä5') || normalizedPhrase.includes('—ç—Ä 5')) {
                continue;
              }
              
              // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ—Ä–∞–∑—É –∏–∑ —Å–ª–æ–≤–∞—Ä—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
              const normalizedDictPhrase = phrase.toLowerCase().replace(/—Ä/g, 'r').replace(/—Å/g, 's');
              
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ö–æ–∂–¥–µ–Ω–∏–µ —Ñ—Ä–∞–∑—ã –≤ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (—Å —É—á–µ—Ç–æ–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏)
              if (normalizedForSearch.includes(normalizedDictPhrase) || normalizedDictPhrase.includes(normalizedForSearch)) {
                counterType = type;
                break;
              }
            }

            // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–∫—Ä–æ–º–µ r5)
            const normalizedCounterPhrase = counterPhrase.toLowerCase().replace(/—Ä/g, 'r').replace(/—Å/g, 's');
            if (!counterType && counterTypePhrases[counterPhrase] && 
                !normalizedCounterPhrase.includes('r5') && !normalizedCounterPhrase.includes('—ç—Ä5') && !normalizedCounterPhrase.includes('—ç—Ä 5')) {
              counterType = counterTypePhrases[counterPhrase];
            }
          }

          if (!counterType) {
            showToast(`‚ùå –¢–∏–ø —Å—á–µ—Ç—á–∏–∫–∞ "${counterPhrase}" –Ω–µ –Ω–∞–π–¥–µ–Ω`, 3000, '#a33');
            return;
          }

          const success = await changeCounterType(counterType);
          if (!success) {
            showToast('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø —Å—á–µ—Ç—á–∏–∫–∞', 3000, '#a33');
          }
          return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ–¥–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–ª–æ–≤–æ "–≤—ã–ø—É—Å–∫")
        if (lowerTranscript.includes('–≤—ã–ø—É—Å–∫')) {
          // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ —Å–ª–æ–≤–∞ "–≤—ã–ø—É—Å–∫"
          const yearMatch = lowerTranscript.match(/–≤—ã–ø—É—Å–∫\s+(.+)/);
          if (!yearMatch) {
            showToast('‚ùå –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω –≥–æ–¥', 3000, '#a33');
            return;
          }

          const yearText = yearMatch[1].trim();
          let yearStr = null;

          // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Å–ª–æ–≤–µ—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
          yearStr = parseYearFromText('–≤—ã–ø—É—Å–∫ ' + yearText);
          
          // –ï—Å–ª–∏ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ —Å–ª–æ–≤–µ—Å–Ω–æ, –ø—Ä–æ–±—É–µ–º —á–∏—Å–ª–æ–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
          if (!yearStr) {
            const numericMatch = yearText.match(/^(\d{4}|\d{2})$/);
            if (numericMatch) {
              yearStr = numericMatch[1];
              // –ï—Å–ª–∏ –≥–æ–¥ —É–∫–∞–∑–∞–Ω –¥–≤—É–º—è —Ü–∏—Ñ—Ä–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "15"), –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ 4 —Ü–∏—Ñ—Ä—ã
              if (yearStr.length === 2) {
                const yearNum = parseInt(yearStr, 10);
                // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –≥–æ–¥—ã 00-30 —ç—Ç–æ 2000-2030, –∞ 31-99 —ç—Ç–æ 1931-1999
                yearStr = yearNum <= 30 ? `20${yearStr}` : `19${yearStr}`;
              }
            }
          }

          if (!yearStr) {
            showToast('‚ùå –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω –≥–æ–¥', 3000, '#a33');
            return;
          }

          // –ï—Å–ª–∏ –≥–æ–¥ —É–∫–∞–∑–∞–Ω –¥–≤—É–º—è —Ü–∏—Ñ—Ä–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "15"), –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ 4 —Ü–∏—Ñ—Ä—ã
          if (yearStr.length === 2) {
            const yearNum = parseInt(yearStr, 10);
            // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –≥–æ–¥—ã 00-30 —ç—Ç–æ 2000-2030, –∞ 31-99 —ç—Ç–æ 1931-1999
            yearStr = yearNum <= 30 ? `20${yearStr}` : `19${yearStr}`;
          }

          const year = parseInt(yearStr, 10);
          if (isNaN(year) || year < 1900 || year > 2100) {
            showToast('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–æ–¥', 3000, '#a33');
            return;
          }

          // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª–µ "–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£ - " –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ–¥
          function findManufactureYearField() {
            // –ò—â–µ–º div —Å –∫–ª–∞—Å—Å–æ–º _selectField_1ydb5_1 –∏–ª–∏ _selectField_1mapt_1, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£ -"
            const selectFields = document.querySelectorAll('div._selectField_1ydb5_1, div._selectField_1mapt_1');
            
            for (const el of selectFields) {
              const text = el.textContent || '';
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º–µ–Ω–Ω–æ "–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£ -" —Å —á–∏—Å–ª–æ–º
              const hasYearPattern = text.match(/–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£\s*-\s*\d+/i);
              
              if (hasYearPattern) {
                const labelText = el.querySelector('label span')?.textContent || '';
                if (labelText.includes('–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£') && labelText.match(/–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£\s*-\s*\d+/i)) {
                  return el;
                }
              }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ _selectField, –∏—â–µ–º –ø–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º
            const allElements = document.querySelectorAll('En, en, div, label, span');
            
            for (const el of allElements) {
              const text = el.textContent || '';
              const hasYearPattern = text.match(/–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£\s*-\s*\d+/i);
              
              if (hasYearPattern) {
                const labelText = el.querySelector('label span')?.textContent || el.textContent || '';
                if (labelText.includes('–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£') && labelText.match(/–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£\s*-\s*\d+/i)) {
                  const hasValue = el.querySelector('div._value_8fpl2_13') || 
                                  el.querySelector('div._selectField_1ydb5_1') ||
                                  el.querySelector('div._value_1oihn_13') ||
                                  el.querySelector('div._selectField_1mapt_1');
                  const hasClass = el.classList.contains('_selectField_1ydb5_1') || 
                                  el.classList.contains('_selectField_1mapt_1');
                  
                  if (hasValue || hasClass) {
                    return el;
                  }
                }
              }
            }
            
            return null;
          }
          
          const manufactureYearField = findManufactureYearField();
          
          if (manufactureYearField) {
            // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—É—â–∏–π –≥–æ–¥ –∏–∑ <b> —Ç–µ–≥–∞ –≤–Ω—É—Ç—Ä–∏ <span> —Å —Ç–µ–∫—Å—Ç–æ–º "–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£ -"
            let currentYear = null;
            
            const spans = manufactureYearField.querySelectorAll('span, label span');
            
            for (const span of spans) {
              const spanText = span.textContent || '';
              
              if (spanText.includes('–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£') && spanText.includes('-')) {
                // –ò—â–µ–º <b> —Ç–µ–≥ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ span
                const bTag = span.querySelector('b');
                
                if (bTag) {
                  const bText = bTag.textContent.trim();
                  const num = parseInt(bText, 10);
                  if (!isNaN(num) && num >= 1900 && num <= 2100) {
                    currentYear = num;
                    break;
                  }
                }
                
                // –ï—Å–ª–∏ <b> –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –∏–∑ —Ç–µ–∫—Å—Ç–∞ span
                if (!currentYear) {
                  const match = spanText.match(/–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£\s*-\s*(\d+)/i);
                  if (match) {
                    const num = parseInt(match[1], 10);
                    if (!isNaN(num) && num >= 1900 && num <= 2100) {
                      currentYear = num;
                      break;
                    }
                  }
                }
              }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ span, –ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –∏–∑ –≤—Å–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
            if (currentYear === null) {
              const yearText = manufactureYearField.textContent.trim();
              const yearMatch = yearText.match(/–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£\s*-\s*(\d+)/i);
              if (yearMatch) {
                const num = parseInt(yearMatch[1], 10);
                if (!isNaN(num) && num >= 1900 && num <= 2100) {
                  currentYear = num;
                }
              }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –≥–æ–¥
            if (currentYear !== null && currentYear === year) {
              // –ì–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –Ω–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –¥–∞—Ç—ã
              showToast(`‚úÖ –ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: ${year}`, 3000, '#2a7');
              return;
            }
            
            // –ì–æ–¥ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å–µ–ª–µ–∫—Ç
            // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Å–æ–º _value_8fpl2_13 –∏–ª–∏ _value_1oihn_13, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
            let complianceValueEl = null;
            
            const allValueElements = manufactureYearField.querySelectorAll('div._value_8fpl2_13, div._value_1oihn_13');
            for (const valueEl of allValueElements) {
              if (valueEl.textContent.trim() === '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç' || valueEl.textContent.trim() === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
                complianceValueEl = valueEl;
                break;
              }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –≤–Ω—É—Ç—Ä–∏, –∏—â–µ–º –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
            if (!complianceValueEl) {
              let parent = manufactureYearField.parentElement;
              let searchDepth = 0;
              while (parent && searchDepth < 5) {
                const values = parent.querySelectorAll('div._value_8fpl2_13, div._value_1oihn_13');
                for (const valueEl of values) {
                  const valueText = valueEl.textContent.trim();
                  if ((valueText === '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç' || valueText === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') &&
                      parent.textContent.includes('–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£')) {
                    complianceValueEl = valueEl;
                    break;
                  }
                }
                if (complianceValueEl) break;
                parent = parent.parentElement;
                searchDepth++;
              }
            }
            
            // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –∏—â–µ–º –≤–æ –≤—Å–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ —Ä—è–¥–æ–º —Å —Ç–µ–∫—Å—Ç–æ–º "–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£"
            if (!complianceValueEl) {
              const allValues = document.querySelectorAll('div._value_8fpl2_13, div._value_1oihn_13');
              for (const valueEl of allValues) {
                const container = valueEl.closest('div, En, en');
                if (container && container.textContent && container.textContent.includes('–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£')) {
                  const valueText = valueEl.textContent.trim();
                  if (valueText === '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç' || valueText === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
                    complianceValueEl = valueEl;
                    break;
                  }
                }
              }
            }
            
            if (complianceValueEl) {
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
              if (complianceValueEl.textContent.trim() === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
                // –£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç", –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ fact_counter_manufacture_year
                let factYearInput = document.querySelector('input#fact_counter_manufacture_year') ||
                                   document.querySelector('input[name="fact_counter_manufacture_year"]');
                
                if (factYearInput && factYearInput.offsetParent !== null) {
                  await setReactInputValue('input#fact_counter_manufacture_year', yearStr);
                } else {
                  // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—è
                  for (let i = 0; i < 20; i++) {
                    await new Promise(r => setTimeout(r, 100));
                    factYearInput = document.querySelector('input#fact_counter_manufacture_year') ||
                                   document.querySelector('input[name="fact_counter_manufacture_year"]');
                    if (factYearInput && factYearInput.offsetParent !== null) break;
                  }
                  
                  if (factYearInput && factYearInput.offsetParent !== null) {
                    await setReactInputValue('input#fact_counter_manufacture_year', yearStr);
                  } else {
                    showToast('‚ùå –ü–æ–ª–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –≥–æ–¥–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å', 3000, '#a33');
                    return;
                  }
                }
              } else {
                // –ö–ª–∏–∫–∞–µ–º –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏
                complianceValueEl.click();
                await new Promise(r => setTimeout(r, 400));
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–∞–Ω–µ–ª—å —Å –æ–ø—Ü–∏—è–º–∏ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
                let panel = null;
                for (let i = 0; i < 15; i++) {
                  await new Promise(r => setTimeout(r, 100));
                  panel = document.querySelector('._panel_1q4rd_19.slide-up-enter-done') ||
                          document.querySelector('._panel_1q4rd_19') ||
                          document.querySelector('._panel_1i7mm_19.slide-up-enter-done') ||
                          document.querySelector('._panel_1i7mm_19');
                  if (panel) break;
                }
                
                if (!panel) {
                  showToast('‚ùå –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 3000, '#a33');
                  return;
                }
                
                // –ò—â–µ–º –æ–ø—Ü–∏—é "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" —Å –∫–ª–∞—Å—Å–æ–º _option_8fpl2_78
                let notCompliantOption = null;
                const allOptions = panel.querySelectorAll('._option_8fpl2_78, ._option_1oihn_78, [class*="option"]');
                for (const option of allOptions) {
                  const span = option.querySelector('span');
                  const text = span ? span.textContent.trim() : option.textContent.trim();
                  if (text === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
                    notCompliantOption = option;
                    break;
                  }
                }
                
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ —Ç–µ–∫—Å—Ç—É, –ø—Ä–æ–±—É–µ–º –ø–æ nth-child (–≤—Ç–æ—Ä–∞—è –æ–ø—Ü–∏—è –æ–±—ã—á–Ω–æ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç")
                if (!notCompliantOption) {
                  notCompliantOption = panel.querySelector('._option_8fpl2_78:nth-child(2)') ||
                                      panel.querySelector('._option_1oihn_78:nth-child(2)');
                }
                
                if (!notCompliantOption) {
                  showToast('‚ùå –û–ø—Ü–∏—è "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 3000, '#a33');
                  return;
                }
                
                // –ö–ª–∏–∫–∞–µ–º –Ω–∞ –æ–ø—Ü–∏—é "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
                notCompliantOption.click();
                await new Promise(r => setTimeout(r, 400));
                
                // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—è fact_counter_manufacture_year
                let factYearInput = null;
                for (let i = 0; i < 30; i++) {
                  await new Promise(r => setTimeout(r, 100));
                  factYearInput = document.querySelector('input#fact_counter_manufacture_year') ||
                                 document.querySelector('input[name="fact_counter_manufacture_year"]');
                  if (factYearInput && factYearInput.offsetParent !== null) break;
                }
                
                if (factYearInput && factYearInput.offsetParent !== null) {
                  await setReactInputValue('input#fact_counter_manufacture_year', yearStr);
                } else {
                  showToast('‚ùå –ü–æ–ª–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –≥–æ–¥–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å', 3000, '#a33');
                  return;
                }
              }
            } else {
              showToast('‚ùå –≠–ª–µ–º–µ–Ω—Ç "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" –Ω–µ –Ω–∞–π–¥–µ–Ω', 3000, '#a33');
              return;
            }
          } else {
            // –ï—Å–ª–∏ –ø–æ–ª–µ "–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£ - " –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –≥–æ–¥–∞
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –≥–æ–¥–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ü–£ (type="number")
            function findFactYearInput() {
              const enComponent = document.querySelector('En[name="fact_counter_manufacture_year"]') ||
                                 document.querySelector('en[name="fact_counter_manufacture_year"]') ||
                                 document.querySelector('[name="fact_counter_manufacture_year"]');
              
              if (enComponent) {
                const input = enComponent.querySelector('input[name="fact_counter_manufacture_year"]') ||
                             enComponent.querySelector('input#fact_counter_manufacture_year') ||
                             enComponent.querySelector('input[type="number"]');
                if (input) return input;
              }
              
              return document.querySelector('input#fact_counter_manufacture_year') ||
                     document.querySelector('input[name="fact_counter_manufacture_year"]');
            }
            
            let factYearInput = findFactYearInput();
            
            if (!factYearInput) {
              for (let i = 0; i < 10; i++) {
                await new Promise(r => setTimeout(r, 100));
                factYearInput = findFactYearInput();
                if (factYearInput) break;
              }
            }
            
            if (factYearInput) {
              await setReactInputValue('input#fact_counter_manufacture_year', yearStr);
            }
          }

          // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –≥–æ–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–≤–µ—Ä–∫–∏ (type="date") - –º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≥–æ–¥
          // –ò—â–µ–º –ø–æ–ª–µ –ø–æ —Ä–∞–∑–Ω—ã–º —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º, –≤–∫–ª—é—á–∞—è –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç En
          let lastInspectionInput = null;
          
          // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ input —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç En –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
          function findLastInspectionInput() {
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç En —Å name="last_inspection_year"
            const enComponent = document.querySelector('En[name="last_inspection_year"]') ||
                               document.querySelector('en[name="last_inspection_year"]') ||
                               document.querySelector('[name="last_inspection_year"]');
            
            if (enComponent) {
              // –ò—â–µ–º input –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ En
              const input = enComponent.querySelector('input[name="last_inspection_year"]') ||
                           enComponent.querySelector('input#last_inspection_year') ||
                           enComponent.querySelector('input[type="date"]');
              if (input) return input;
            }
            
            // –ò—â–µ–º –ø–æ name –∞—Ç—Ä–∏–±—É—Ç—É
            const inputByName = document.querySelector('input[name="last_inspection_year"]') ||
                               document.querySelector('input#last_inspection_year') ||
                               document.querySelector('input[type="date"][name="last_inspection_year"]');
            if (inputByName) return inputByName;
            
            // –ò—â–µ–º –ø–æ label "–î–∞—Ç–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–≤–µ—Ä–∫–∏" (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
            const labels = Array.from(document.querySelectorAll('label'));
            const targetLabel = labels.find(l => l.textContent && l.textContent.includes('–î–∞—Ç–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–≤–µ—Ä–∫–∏'));
            
            if (targetLabel) {
              // –ò—â–µ–º input –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Ä—è–¥–æ–º —Å label
              let container = targetLabel.nextElementSibling;
              if (!container || !container.classList.contains('_inputContainer_27y0k_15')) {
                container = targetLabel.parentElement.querySelector('._inputContainer_27y0k_15');
              }
              
              if (container) {
                const input = container.querySelector('input[type="date"]');
                if (input) return input;
              }
              
              // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∏—â–µ–º –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
              const parentContainer = targetLabel.closest('._dateInput_27y0k_1') || 
                                     targetLabel.closest('div');
              if (parentContainer) {
                const input = parentContainer.querySelector('input[type="date"]');
                if (input) return input;
              }
            }
            
            // –í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null, —á—Ç–æ–±—ã –Ω–µ –≤—ã–±—Ä–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ
            return null;
          }
          
          lastInspectionInput = findLastInspectionInput();
          
          // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º, –∂–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—è
          if (!lastInspectionInput) {
            for (let i = 0; i < 10; i++) {
              await new Promise(r => setTimeout(r, 100));
              lastInspectionInput = findLastInspectionInput();
              if (lastInspectionInput) break;
            }
          }
          
          if (lastInspectionInput) {
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∞—Ç—ã
            let currentDateValue = lastInspectionInput.value;
            
            // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –≥–æ–¥, –ø—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –¥–∞—Ç—É –∏–∑ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
            if (!currentDateValue || currentDateValue.length < 10) {
              // –ò—â–µ–º span –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏–ª–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ En
              const enComponent = lastInspectionInput.closest('En') || lastInspectionInput.closest('en');
              const container = lastInspectionInput.closest('._inputContainer_27y0k_15') || 
                               enComponent ||
                               lastInspectionInput.parentElement;
              
              if (container) {
                // –ò—â–µ–º span —Å –¥–∞—Ç–æ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ "DD.MM.YYYY"
                const spans = container.querySelectorAll('span');
                for (const span of spans) {
                  if (span.textContent) {
                    const spanText = span.textContent.trim();
                    // –ü–∞—Ä—Å–∏–º —Ñ–æ—Ä–º–∞—Ç "08.05.2013" -> "2013-05-08"
                    const dateMatch = spanText.match(/(\d{2})\.(\d{2})\.(\d{4})/);
                    if (dateMatch) {
                      // –§–æ—Ä–º–∞—Ç: –¥–µ–Ω—å.–º–µ—Å—è—Ü.–≥–æ–¥ -> –≥–æ–¥-–º–µ—Å—è—Ü-–¥–µ–Ω—å
                      currentDateValue = `${dateMatch[3]}-${dateMatch[2]}-${dateMatch[1]}`;
                      break;
                    }
                  }
                }
              }
            }
            
            // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –ø—É—Å—Ç–æ–µ, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ç—Ä–∏–±—É—Ç value
            if (!currentDateValue || currentDateValue.length < 10) {
              const valueAttr = lastInspectionInput.getAttribute('value');
              if (valueAttr) {
                // –ï—Å–ª–∏ –≤ –∞—Ç—Ä–∏–±—É—Ç–µ —Ç–æ–ª—å–∫–æ –≥–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "2016"), –ø—ã—Ç–∞–µ–º—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
                if (/^\d{4}$/.test(valueAttr)) {
                  // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—É –∏–∑ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                  // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
                  if (!currentDateValue || currentDateValue.length < 10) {
                    const now = new Date();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    currentDateValue = `${valueAttr}-${month}-${day}`;
                  } else {
                    // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –¥–∞—Ç–∞ –∏–∑ span, –∑–∞–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≥–æ–¥
                    const dateParts = currentDateValue.split('-');
                    if (dateParts.length === 3) {
                      currentDateValue = `${valueAttr}-${dateParts[1]}-${dateParts[2]}`;
                    }
                  }
                } else if (/^\d{4}-\d{2}-\d{2}$/.test(valueAttr)) {
                  // –ï—Å–ª–∏ —É–∂–µ –ø–æ–ª–Ω–∞—è –¥–∞—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
                  currentDateValue = valueAttr;
                }
              } else {
                // –ï—Å–ª–∏ –∞—Ç—Ä–∏–±—É—Ç value –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–∞–º–æ —Å–≤–æ–π—Å—Ç–≤–æ value
                const inputValue = lastInspectionInput.value;
                if (inputValue) {
                  if (/^\d{4}$/.test(inputValue)) {
                    // –ï—Å–ª–∏ value —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –≥–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É —Å —ç—Ç–∏–º –≥–æ–¥–æ–º
                    if (!currentDateValue || currentDateValue.length < 10) {
                      const now = new Date();
                      const month = String(now.getMonth() + 1).padStart(2, '0');
                      const day = String(now.getDate()).padStart(2, '0');
                      currentDateValue = `${inputValue}-${month}-${day}`;
                    } else {
                      // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –¥–∞—Ç–∞ –∏–∑ span, –∑–∞–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≥–æ–¥
                      const dateParts = currentDateValue.split('-');
                      if (dateParts.length === 3) {
                        currentDateValue = `${inputValue}-${dateParts[1]}-${dateParts[2]}`;
                      }
                    }
                  } else if (/^\d{4}-\d{2}-\d{2}$/.test(inputValue)) {
                    // –ï—Å–ª–∏ –ø–æ–ª–Ω–∞—è –¥–∞—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
                    currentDateValue = inputValue;
                  }
                }
              }
            }
            
            // –ï—Å–ª–∏ –ø–æ–ª–µ –≤—Å–µ –µ—â–µ –ø—É—Å—Ç–æ–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
            if (!currentDateValue || currentDateValue.length < 10) {
              const now = new Date();
              currentDateValue = now.toISOString().split('T')[0]; // –§–æ—Ä–º–∞—Ç YYYY-MM-DD
            }
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –º–µ—Å—è—Ü –∏ –¥–µ–Ω—å –∏–∑ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
            const dateParts = currentDateValue.split('-');
            let newDateValue;
            
            if (dateParts.length === 3) {
              // –ó–∞–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≥–æ–¥, –æ—Å—Ç–∞–≤–ª—è—è –º–µ—Å—è—Ü –∏ –¥–µ–Ω—å
              newDateValue = `${yearStr}-${dateParts[1]}-${dateParts[2]}`;
            } else {
              // –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 1 —è–Ω–≤–∞—Ä—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≥–æ–¥–∞
              newDateValue = `${yearStr}-01-01`;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ newDateValue –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD
            if (!/^\d{4}-\d{2}-\d{2}$/.test(newDateValue)) {
              // –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º 1 —è–Ω–≤–∞—Ä—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≥–æ–¥–∞
              newDateValue = `${yearStr}-01-01`;
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ date –ø–æ–ª–µ –±–µ–∑ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å React
            async function setDateValue(input, value) {
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ value –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD
              if (!/^\d{4}-\d{2}-\d{2}$/.test(value)) {
                console.error('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã:', value);
                return false;
              }
              
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ, –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–Ω–æ–≤–∞
              const currentValue = input.value || '';
              if (currentValue === value) {
                return true;
              }
              
              const lastValue = currentValue || '';
              
              // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º focus() —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
              
              // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∞—Ç—Ä–∏–±—É—Ç value, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å (–≤–∞–∂–Ω–æ –¥–ª—è React)
              const oldValueAttr = input.getAttribute('value');
              if (oldValueAttr && oldValueAttr !== value) {
                input.removeAttribute('value');
                await new Promise(r => setTimeout(r, 50));
              }
              
              // –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥: –ò—Å–ø–æ–ª—å–∑—É–µ–º valueAsDate (—Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ —Å React)
              // –ò—Å–ø–æ–ª—å–∑—É–µ–º T12:00:00 –≤–º–µ—Å—Ç–æ T00:00:00 —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏
              let valueSet = false;
              try {
                const dateObj = new Date(value + 'T12:00:00');
                if (!isNaN(dateObj.getTime())) {
                  input.valueAsDate = dateObj;
                  await new Promise(r => setTimeout(r, 150));
                  
                  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç - valueAsDate –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑-–∑–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
                  const resultValue = input.value || '';
                  if (resultValue === value || resultValue.startsWith(value.split('-')[0] + '-')) {
                    valueSet = true;
                    // –ï—Å–ª–∏ valueAsDate –∏–∑–º–µ–Ω–∏–ª –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑-–∑–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º
                    if (resultValue !== value) {
                      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π setter –¥–ª—è —Ç–æ—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏—è
                      const prototype = window.HTMLInputElement.prototype;
                      const nativeValueSetter = Object.getOwnPropertyDescriptor(prototype, 'value')?.set;
                      if (nativeValueSetter) {
                        nativeValueSetter.call(input, value);
                      } else {
                        input.value = value;
                      }
                      await new Promise(r => setTimeout(r, 50));
                    }
                  }
                }
              } catch (e) {
                // –ï—Å–ª–∏ valueAsDate –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
              }
              
              // –ï—Å–ª–∏ valueAsDate –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π setter
              if (!valueSet) {
                const prototype = window.HTMLInputElement.prototype;
                const nativeValueSetter = Object.getOwnPropertyDescriptor(prototype, 'value')?.set;
                
                if (nativeValueSetter) {
                  nativeValueSetter.call(input, value);
                } else {
                  input.value = value;
                }
                await new Promise(r => setTimeout(r, 50));
              }
              
              // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç value (–≤–∞–∂–Ω–æ –¥–ª—è React)
              input.setAttribute('value', value);
              
              // –†–∞–±–æ—Ç–∞–µ–º —Å React —Ç—Ä–µ–∫–µ—Ä–æ–º (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
              try {
                const tracker = input._valueTracker;
                if (tracker && typeof tracker.setValue === 'function') {
                  tracker.setValue(lastValue);
                }
              } catch (e) {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —Ç—Ä–µ–∫–µ—Ä–∞
              }
              
              // –î–∏—Å–ø–∞—Ç—á–∏–º —Å–æ–±—ã—Ç–∏—è –¥–ª—è React
              const inputEvent = new InputEvent('input', { 
                bubbles: true, 
                cancelable: true,
                data: value,
                inputType: 'insertText',
                isComposing: false
              });
              input.dispatchEvent(inputEvent);
              await new Promise(r => setTimeout(r, 100));
              
              const changeEvent = new Event('change', { bubbles: true, cancelable: true });
              input.dispatchEvent(changeEvent);
              await new Promise(r => setTimeout(r, 100));
              
              // –û–±–Ω–æ–≤–ª—è–µ–º span —Å –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–∞—Ç–æ–π (React –º–æ–∂–µ—Ç –Ω–µ –æ–±–Ω–æ–≤–∏—Ç—å –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
              const container = input.closest('._inputContainer_27y0k_15') || 
                               input.closest('En') || 
                               input.closest('en') ||
                               input.parentElement;
              if (container) {
                const span = container.querySelector('span');
                if (span) {
                  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç "DD.MM.YYYY"
                  const [year, month, day] = value.split('-');
                  const formattedDate = `${day}.${month}.${year}`;
                  span.textContent = formattedDate;
                  
                  // –û–±–Ω–æ–≤–ª—è–µ–º span –µ—â–µ —Ä–∞–∑ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (React –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –µ–≥–æ)
                  await new Promise(r => setTimeout(r, 200));
                  if (span.textContent !== formattedDate) {
                    span.textContent = formattedDate;
                  }
                  
                  // –§–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ span –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
                  await new Promise(r => setTimeout(r, 200));
                  if (span.textContent !== formattedDate) {
                    span.textContent = formattedDate;
                  }
                }
              }
              
              // –î–∏—Å–ø–∞—Ç—á–∏–º blur —Å–æ–±—ã—Ç–∏–µ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ blur() —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
              const blurEvent = new Event('blur', { bubbles: true, cancelable: true });
              input.dispatchEvent(blurEvent);
              
              await new Promise(r => setTimeout(r, 200));
              
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç - –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ value, –∏ –∞—Ç—Ä–∏–±—É—Ç
              const finalValue = input.value || '';
              const finalAttr = input.getAttribute('value') || '';
              const success = finalValue === value || finalAttr === value || finalValue.startsWith(value.split('-')[0] + '-');
              
              return success;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º MutationObserver –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π React –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
            let success2 = false;
            let observer = null;
            let retryCount = 0;
            const maxRetries = 10;
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è span
            function updateSpan() {
              const container = lastInspectionInput.closest('._inputContainer_27y0k_15') || 
                               lastInspectionInput.parentElement;
              if (container) {
                const span = container.querySelector('span');
                if (span) {
                  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç "DD.MM.YYYY"
                  const [year, month, day] = newDateValue.split('-');
                  span.textContent = `${day}.${month}.${year}`;
                }
              }
            }
            
            // –°–æ–∑–¥–∞–µ–º MutationObserver –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π React
            observer = new MutationObserver(async (mutations) => {
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏–∑–º–µ–Ω–∏–ª –ª–∏ React –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ
              const currentValue = lastInspectionInput.value || '';
              const currentAttr = lastInspectionInput.getAttribute('value') || '';
              
              // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω—É–∂–Ω–æ–º—É, –ø—ã—Ç–∞–µ–º—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–Ω–æ–≤–∞
              if (currentValue !== newDateValue && currentAttr !== newDateValue && retryCount < maxRetries) {
                retryCount++;
                await new Promise(r => setTimeout(r, 100));
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                const prototype = window.HTMLInputElement.prototype;
                const nativeValueSetter = Object.getOwnPropertyDescriptor(prototype, 'value')?.set;
                
                if (nativeValueSetter) {
                  nativeValueSetter.call(lastInspectionInput, newDateValue);
                } else {
                  lastInspectionInput.value = newDateValue;
                }
                
                lastInspectionInput.setAttribute('value', newDateValue);
                updateSpan();
                
                // –î–∏—Å–ø–∞—Ç—á–∏–º —Å–æ–±—ã—Ç–∏—è
                const inputEvent = new InputEvent('input', { bubbles: true, cancelable: true, data: newDateValue });
                const changeEvent = new Event('change', { bubbles: true, cancelable: true });
                lastInspectionInput.dispatchEvent(inputEvent);
                lastInspectionInput.dispatchEvent(changeEvent);
              } else if (currentValue === newDateValue || currentAttr === newDateValue) {
                // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º observer
                if (observer) {
                  observer.disconnect();
                  observer = null;
                }
                success2 = true;
              }
            });
            
            // –ù–∞—á–∏–Ω–∞–µ–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
            observer.observe(lastInspectionInput, {
              attributes: true,
              attributeFilter: ['value'],
              childList: false,
              subtree: false
            });
            
            // –¢–∞–∫–∂–µ –Ω–∞–±–ª—é–¥–∞–µ–º –∑–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ React –º–µ–Ω—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É)
            const container = lastInspectionInput.closest('._inputContainer_27y0k_15') || lastInspectionInput.parentElement;
            if (container) {
              observer.observe(container, {
                attributes: true,
                childList: true,
                subtree: true
              });
            }
            
            // –ü—ã—Ç–∞–µ–º—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
            for (let attempt = 1; attempt <= 5; attempt++) {
              success2 = await setDateValue(lastInspectionInput, newDateValue);
              updateSpan();
              
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
              await new Promise(r => setTimeout(r, 200));
              const finalValue = lastInspectionInput.value || '';
              const finalAttr = lastInspectionInput.getAttribute('value') || '';
              
              if (finalValue === newDateValue || finalAttr === newDateValue) {
                success2 = true;
                if (observer) {
                  observer.disconnect();
                  observer = null;
                }
                break;
              }
              
              // –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å –∏ —ç—Ç–æ –Ω–µ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ - –∂–¥–µ–º –∏ –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
              if (attempt < 5) {
                await new Promise(r => setTimeout(r, 200));
              }
            }
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º observer —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã, –µ—Å–ª–∏ –æ–Ω –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
            setTimeout(() => {
              if (observer) {
                observer.disconnect();
                observer = null;
              }
            }, 2000);
            
            if (!success2) {
              showToast('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–æ–¥ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–≤–µ—Ä–∫–∏', 3000, '#ffa500');
            } else {
              // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è last_inspection_year, –æ–±–Ω–æ–≤–ª—è–µ–º next_inspection_year
              // –ò—Å–ø–æ–ª—å–∑—É–µ–º newDateValue –Ω–∞–ø—Ä—è–º—É—é (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ) –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
              const dateParts = newDateValue.split('-');
              if (dateParts.length === 3) {
                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç Date –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–π –¥–∞—Ç—ã
                const lastDate = new Date(newDateValue + 'T12:00:00');
                // –î–æ–±–∞–≤–ª—è–µ–º 16 –ª–µ—Ç
                lastDate.setFullYear(lastDate.getFullYear() + 16);
                // –í—ã—á–∏—Ç–∞–µ–º –æ–¥–∏–Ω –¥–µ–Ω—å
                lastDate.setDate(lastDate.getDate() - 1);
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ YYYY-MM-DD
                const year = lastDate.getFullYear();
                const month = String(lastDate.getMonth() + 1).padStart(2, '0');
                const day = String(lastDate.getDate()).padStart(2, '0');
                const nextInspectionDate = `${year}-${month}-${day}`;
                
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—è next_inspection_year
                function findNextInspectionInput() {
                  // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç En —Å name="next_inspection_year"
                  const enComponent = document.querySelector('En[name="next_inspection_year"]') ||
                                     document.querySelector('en[name="next_inspection_year"]') ||
                                     document.querySelector('[name="next_inspection_year"]');
                  
                  if (enComponent) {
                    // –ò—â–µ–º input –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ En
                    const input = enComponent.querySelector('input[name="next_inspection_year"]') ||
                                 enComponent.querySelector('input#next_inspection_year') ||
                                 enComponent.querySelector('input[type="date"]');
                    if (input) return input;
                  }
                  
                  // –ò—â–µ–º –ø–æ name –∞—Ç—Ä–∏–±—É—Ç—É
                  const inputByName = document.querySelector('input[name="next_inspection_year"]') ||
                                     document.querySelector('input#next_inspection_year') ||
                                     document.querySelector('input[type="date"][name="next_inspection_year"]');
                  if (inputByName) return inputByName;
                  
                  // –ò—â–µ–º –ø–æ label "–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–≤–µ—Ä–∫–∏" (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
                  const labels = Array.from(document.querySelectorAll('label'));
                  const targetLabel = labels.find(l => l.textContent && l.textContent.includes('–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–≤–µ—Ä–∫–∏'));
                  
                  if (targetLabel) {
                    // –ò—â–µ–º input –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Ä—è–¥–æ–º —Å label
                    let container = targetLabel.nextElementSibling;
                    if (!container || !container.classList.contains('_inputContainer_27y0k_15')) {
                      container = targetLabel.parentElement.querySelector('._inputContainer_27y0k_15');
                    }
                    
                    if (container) {
                      const input = container.querySelector('input[type="date"]');
                      if (input) return input;
                    }
                    
                    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∏—â–µ–º –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
                    const parentContainer = targetLabel.closest('._dateInput_27y0k_1') || 
                                           targetLabel.closest('div');
                    if (parentContainer) {
                      const input = parentContainer.querySelector('input[type="date"]');
                      if (input) return input;
                    }
                  }
                  
                  // –í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null, —á—Ç–æ–±—ã –Ω–µ –≤—ã–±—Ä–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ
                  return null;
                }
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª–µ next_inspection_year (—É–º–µ–Ω—å—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –∏ –∑–∞–¥–µ—Ä–∂–µ–∫)
                let nextInspectionInput = findNextInspectionInput();
                
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –∂–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—è (—É—Å–∫–æ—Ä–µ–Ω–æ: 5 –ø–æ–ø—ã—Ç–æ–∫ –ø–æ 30–º—Å –≤–º–µ—Å—Ç–æ 10 –ø–æ 100–º—Å)
                if (!nextInspectionInput) {
                  for (let i = 0; i < 5; i++) {
                    await new Promise(r => setTimeout(r, 30));
                    nextInspectionInput = findNextInspectionInput();
                    if (nextInspectionInput) break;
                  }
                }
                
                if (nextInspectionInput) {
                  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ date –ø–æ–ª–µ next_inspection_year (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –±–µ–∑ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏)
                  async function setDateValueForNext(input, value) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ value –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD
                    if (!/^\d{4}-\d{2}-\d{2}$/.test(value)) {
                      console.error('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã:', value);
                      return false;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ, –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–Ω–æ–≤–∞
                    const currentValue = input.value || '';
                    if (currentValue === value) {
                      return true;
                    }
                    
                    const lastValue = currentValue || '';
                    
                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∞—Ç—Ä–∏–±—É—Ç value, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å (–≤–∞–∂–Ω–æ –¥–ª—è React)
                    const oldValueAttr = input.getAttribute('value');
                    if (oldValueAttr && oldValueAttr !== value) {
                      input.removeAttribute('value');
                    }
                    
                    // –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥: –ò—Å–ø–æ–ª—å–∑—É–µ–º valueAsDate (—Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ —Å React)
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º T12:00:00 –≤–º–µ—Å—Ç–æ T00:00:00 —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏
                    let valueSet = false;
                    try {
                      const dateObj = new Date(value + 'T12:00:00');
                      if (!isNaN(dateObj.getTime())) {
                        input.valueAsDate = dateObj;
                        await new Promise(r => setTimeout(r, 50)); // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 150–º—Å
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç - valueAsDate –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑-–∑–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
                        const resultValue = input.value || '';
                        if (resultValue === value || resultValue.startsWith(value.split('-')[0] + '-')) {
                          valueSet = true;
                          // –ï—Å–ª–∏ valueAsDate –∏–∑–º–µ–Ω–∏–ª –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑-–∑–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º
                          if (resultValue !== value) {
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π setter –¥–ª—è —Ç–æ—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏—è
                            const prototype = window.HTMLInputElement.prototype;
                            const nativeValueSetter = Object.getOwnPropertyDescriptor(prototype, 'value')?.set;
                            if (nativeValueSetter) {
                              nativeValueSetter.call(input, value);
                            } else {
                              input.value = value;
                            }
                          }
                        }
                      }
                    } catch (e) {
                      // –ï—Å–ª–∏ valueAsDate –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
                    }
                    
                    // –ï—Å–ª–∏ valueAsDate –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π setter
                    if (!valueSet) {
                      const prototype = window.HTMLInputElement.prototype;
                      const nativeValueSetter = Object.getOwnPropertyDescriptor(prototype, 'value')?.set;
                      
                      if (nativeValueSetter) {
                        nativeValueSetter.call(input, value);
                      } else {
                        input.value = value;
                      }
                    }
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç value (–≤–∞–∂–Ω–æ –¥–ª—è React)
                    input.setAttribute('value', value);
                    
                    // –†–∞–±–æ—Ç–∞–µ–º —Å React —Ç—Ä–µ–∫–µ—Ä–æ–º (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
                    try {
                      const tracker = input._valueTracker;
                      if (tracker && typeof tracker.setValue === 'function') {
                        tracker.setValue(lastValue);
                      }
                    } catch (e) {
                      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —Ç—Ä–µ–∫–µ—Ä–∞
                    }
                    
                    // –î–∏—Å–ø–∞—Ç—á–∏–º —Å–æ–±—ã—Ç–∏—è –¥–ª—è React (—É–º–µ–Ω—å—à–µ–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏)
                    const inputEvent = new InputEvent('input', { 
                      bubbles: true, 
                      cancelable: true,
                      data: value,
                      inputType: 'insertText',
                      isComposing: false
                    });
                    input.dispatchEvent(inputEvent);
                    
                    const changeEvent = new Event('change', { bubbles: true, cancelable: true });
                    input.dispatchEvent(changeEvent);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º span —Å –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–∞—Ç–æ–π (React –º–æ–∂–µ—Ç –Ω–µ –æ–±–Ω–æ–≤–∏—Ç—å –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
                    const container = input.closest('._inputContainer_27y0k_15') || 
                                     input.closest('En') || 
                                     input.closest('en') ||
                                     input.parentElement;
                    if (container) {
                      const span = container.querySelector('span');
                      if (span) {
                        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç "DD.MM.YYYY"
                        const [year, month, day] = value.split('-');
                        const formattedDate = `${day}.${month}.${year}`;
                        span.textContent = formattedDate;
                      }
                    }
                    
                    // –î–∏—Å–ø–∞—Ç—á–∏–º blur —Å–æ–±—ã—Ç–∏–µ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ blur() —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                    const blurEvent = new Event('blur', { bubbles: true, cancelable: true });
                    input.dispatchEvent(blurEvent);
                    
                    await new Promise(r => setTimeout(r, 50)); // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 200–º—Å
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç - –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ value, –∏ –∞—Ç—Ä–∏–±—É—Ç
                    const finalValue = input.value || '';
                    const finalAttr = input.getAttribute('value') || '';
                    const success = finalValue === value || finalAttr === value || finalValue.startsWith(value.split('-')[0] + '-');
                    
                    return success;
                  }
                  
                  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ (—É–º–µ–Ω—å—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫)
                  let successNext = false;
                  for (let attempt = 1; attempt <= 3; attempt++) { // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 5 –¥–æ 3
                    successNext = await setDateValueForNext(nextInspectionInput, nextInspectionDate);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
                    await new Promise(r => setTimeout(r, 50)); // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 200–º—Å
                    const finalValue = nextInspectionInput.value || '';
                    const finalAttr = nextInspectionInput.getAttribute('value') || '';
                    
                    if (finalValue === nextInspectionDate || finalAttr === nextInspectionDate) {
                      successNext = true;
                      break;
                    }
                    
                    // –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å –∏ —ç—Ç–æ –Ω–µ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ - –∂–¥–µ–º –∏ –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
                    if (attempt < 3) {
                      await new Promise(r => setTimeout(r, 50)); // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 200–º—Å
                    }
                  }
                  
                  if (!successNext) {
                    showToast('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–≤–µ—Ä–∫–∏', 3000, '#ffa500');
                  }
                }
              }
            }
          }

          if (!factYearInput && !lastInspectionInput) {
            showToast('‚ùå –ü–æ–ª—è –≥–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 3000, '#a33');
            return;
          }

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø–æ–ª–µ –±—ã–ª–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
          if (factYearInput || lastInspectionInput) {
            showToast(`‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≥–æ–¥: ${yearStr}`, 3000, '#2a7');
          }
          return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫ –Ω–æ–º–µ—Ä—É –ø–ª–æ–º–±—ã (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–ª–æ–≤–æ "–ø–ª–æ–º–±–∞")
        if (lowerTranscript.includes('–ø–ª–æ–º–±–∞')) {
          // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ —Å–ª–æ–≤–∞ "–ø–ª–æ–º–±–∞"
          const sealMatch = lowerTranscript.match(/–ø–ª–æ–º–±–∞\s+(.+)/);
          if (!sealMatch) {
            showToast('‚ùå –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω –Ω–æ–º–µ—Ä –ø–ª–æ–º–±—ã', 3000, '#a33');
            return;
          }

          const sealText = sealMatch[1].trim();
          
          // –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∏—Å–ª–æ –∏–∑ —Ç–µ–∫—Å—Ç–∞ (—Ü–∏—Ñ—Ä—ã)
          const digits = sealText.replace(/\D/g, '');
          if (!digits) {
            showToast('‚ùå –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ —á–∏—Å–ª–æ –¥–ª—è –ø–ª–æ–º–±—ã', 3000, '#a33');
            return;
          }

          // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª–µ –Ω–æ–º–µ—Ä–∞ –ø–ª–æ–º–±—ã
          const sealInput = document.querySelector('input#seal_number_terminal_cover');
          if (!sealInput) {
            showToast('‚ùå –ü–æ–ª–µ –Ω–æ–º–µ—Ä–∞ –ø–ª–æ–º–±—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 3000, '#a33');
            return;
          }

          // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
          const currentValue = sealInput.value || '';

          // –î–æ–±–∞–≤–ª—è–µ–º —á–∏—Å–ª–æ –≤ –∫–æ–Ω–µ—Ü
          const newValue = currentValue + digits;

          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
          const success = await setReactInputValue('input#seal_number_terminal_cover', newValue);
          if (!success) {
            showToast('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–º–µ—Ä –ø–ª–æ–º–±—ã', 3000, '#a33');
            return;
          }

          showToast(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∫ –Ω–æ–º–µ—Ä—É –ø–ª–æ–º–±—ã: ${digits}`, 3000, '#2a7');
          return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∏—Å–∫ –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø–æ –∞–¥—Ä–µ—Å—É (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–ª–æ–≤–æ "–∞–¥—Ä–µ—Å")
        if (lowerTranscript.includes('–∞–¥—Ä–µ—Å')) {
          // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø–æ—Å–ª–µ —Å–ª–æ–≤–∞ "–∞–¥—Ä–µ—Å"
          const addressMatch = lowerTranscript.match(/–∞–¥—Ä–µ—Å\s+(.+)/);
          if (!addressMatch) {
            showToast('‚ùå –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã', 3000, '#a33');
            return;
          }

          const apartmentText = addressMatch[1].trim();
          
          // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã (—Ü–∏—Ñ—Ä—ã –∏–ª–∏ —Å–ª–æ–≤–∞)
          let apartmentNumber = null;
          
          // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å —Ü–∏—Ñ—Ä—ã
          const digits = apartmentText.replace(/\D/g, '');
          if (digits) {
            apartmentNumber = digits;
          } else {
            // –ï—Å–ª–∏ —Ü–∏—Ñ—Ä –Ω–µ—Ç, –ø—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Å–ª–æ–≤–µ—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
            const normalizedText = apartmentText.toLowerCase().trim();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ —Å–ª–æ–≤–∞—Ä–µ russianNumbers (0-9)
            if (russianNumbers[normalizedText] !== undefined) {
              apartmentNumber = russianNumbers[normalizedText].toString();
            } else {
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ —Å–ª–æ–≤–∞—Ä–µ russianYearNumbers (0-99, –≤–∫–ª—é—á–∞—è –ø–æ—Ä—è–¥–∫–æ–≤—ã–µ)
              if (russianYearNumbers[normalizedText] !== undefined) {
                apartmentNumber = russianYearNumbers[normalizedText].toString();
              } else {
                // –£–±–∏—Ä–∞–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ—Ä—è–¥–∫–æ–≤—ã—Ö —á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∏ –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
                const normalizedWithoutEnding = normalizedText.replace(/(—ã–π|–æ–π|–∏–π)$/i, '').trim();
                if (normalizedWithoutEnding && russianYearNumbers[normalizedWithoutEnding] !== undefined) {
                  apartmentNumber = russianYearNumbers[normalizedWithoutEnding].toString();
                }
              }
            }
          }
          
          if (!apartmentNumber) {
            showToast('‚ùå –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã', 3000, '#a33');
            return;
          }

          // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä
          const taskItems = document.querySelectorAll('div._taskItem_36r29_38');
          if (taskItems.length === 0) {
            showToast('‚ùå –°–ø–∏—Å–æ–∫ –∫–≤–∞—Ä—Ç–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω', 3000, '#a33');
            return;
          }

          // –ò—â–µ–º –∫–≤–∞—Ä—Ç–∏—Ä—É —Å –Ω—É–∂–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º
          let foundItem = null;
          for (const item of taskItems) {
            const titleElement = item.querySelector('div._taskTitle_36r29_45');
            if (!titleElement) continue;

            const titleText = titleElement.textContent.trim();

            // –ê–¥—Ä–µ—Å –∏–º–µ–µ—Ç —Ñ–æ—Ä–º–∞—Ç: "–ì–æ—Ä–æ–¥, –£–ª–∏—Ü–∞, –î–æ–º, –ö–≤–∞—Ä—Ç–∏—Ä–∞" –∏–ª–∏ "–ì–æ—Ä–æ–¥, –£–ª–∏—Ü–∞, –î–æ–º, –ë—É–∫–≤–∞, –ö–≤–∞—Ä—Ç–∏—Ä–∞"
            // –†–∞–∑–±–∏–≤–∞–µ–º –∞–¥—Ä–µ—Å –ø–æ –∑–∞–ø—è—Ç—ã–º
            const addressParts = titleText.split(',').map(part => part.trim());
            
            if (addressParts.length === 0) continue;

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —á–∏—Å–ª–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏ (–¥–æ –∑–Ω–∞–∫–∞ ‚Ññ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤)
            const extractFirstNumber = (str) => {
              // –£–±–∏—Ä–∞–µ–º –≤—Å–µ, —á—Ç–æ –ø–æ—Å–ª–µ <br> –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏
              const clean = str.split(/\s*<br>|\n/)[0].trim();
              // –ò—â–µ–º –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –ø–µ—Ä–µ–¥ –Ω–∏–º)
              const match = clean.match(/^\s*(\d+)/);
              return match ? match[1] : null;
            };

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –∫–æ–º–Ω–∞—Ç—ã –∏–∑ –∫–æ–º–º—É–Ω–∞–ª–∫–∏ (—Ñ–æ—Ä–º–∞—Ç: "1–∫–æ–º.9", "3–∫–æ–º.55", "3–∫–æ–º.48–∞")
            const extractRoomNumber = (str) => {
              // –£–±–∏—Ä–∞–µ–º –≤—Å–µ, —á—Ç–æ –ø–æ—Å–ª–µ <br> –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏
              const clean = str.split(/\s*<br>|\n/)[0].trim();
              // –ò—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω "–∫–æ–º." –∏–ª–∏ "–∫–æ–º " (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–µ–ª) –∏ –Ω–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã –ø–æ—Å–ª–µ –Ω–µ–≥–æ
              // –ù–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã –º–æ–∂–µ—Ç –±—ã—Ç—å —Å –±—É–∫–≤–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "48–∞", "64–∞")
              const match = clean.match(/–∫–æ–º\.?\s*(\d+[–∞-—èa-z]?)/i);
              return match ? match[1] : null;
            };

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –∫–æ–º–Ω–∞—Ç—ã –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ "–∫–≤–∞—Ä—Ç–∏—Ä–∞/–∫–æ–º–Ω–∞—Ç–∞" (—Ñ–æ—Ä–º–∞—Ç: "1/3–∞", "2/5", "5/21–∞")
            const extractRoomNumberFromSlash = (str) => {
              // –£–±–∏—Ä–∞–µ–º –≤—Å–µ, —á—Ç–æ –ø–æ—Å–ª–µ <br> –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏
              const clean = str.split(/\s*<br>|\n/)[0].trim();
              // –ò—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω "—á–∏—Å–ª–æ/—á–∏—Å–ª–æ" –∏–ª–∏ "—á–∏—Å–ª–æ/—á–∏—Å–ª–æ+–±—É–∫–≤–∞"
              // –ù–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã –∏–¥–µ—Ç –ø–æ—Å–ª–µ —Å–ª–µ—à–∞
              const match = clean.match(/\d+\/(\d+[–∞-—èa-z]?)/);
              return match ? match[1] : null;
            };

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç
            const lastPart = addressParts[addressParts.length - 1];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Ñ–æ—Ä–º–∞—Ç–æ–º "–∫–≤–∞—Ä—Ç–∏—Ä–∞/–∫–æ–º–Ω–∞—Ç–∞" (–µ—Å—Ç—å —Å–ª–µ—à)
            const isSlashFormat = /\d+\/\d+/.test(lastPart);
            
            if (isSlashFormat) {
              // –≠—Ç–æ —Ñ–æ—Ä–º–∞—Ç "–∫–≤–∞—Ä—Ç–∏—Ä–∞/–∫–æ–º–Ω–∞—Ç–∞", –∏—â–µ–º –Ω–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã –ø–æ—Å–ª–µ —Å–ª–µ—à–∞
              const roomNumber = extractRoomNumberFromSlash(lastPart);
              
              if (roomNumber) {
                // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å –±—É–∫–≤–æ–π, –ø–æ—ç—Ç–æ–º—É —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏)
                // –ï—Å–ª–∏ –∏—Å–∫–æ–º—ã–π –Ω–æ–º–µ—Ä –±–µ–∑ –±—É–∫–≤—ã, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä–æ–≤—É—é —á–∞—Å—Ç—å
                const roomNumberDigits = roomNumber.replace(/\D/g, '');
                const searchNumberDigits = apartmentNumber.replace(/\D/g, '');
                
                // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º: –ª–∏–±–æ –ø–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (—Å –±—É–∫–≤–æ–π), –ª–∏–±–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ü–∏—Ñ—Ä
                if (roomNumber === apartmentNumber || roomNumberDigits === searchNumberDigits) {
                  foundItem = item;
                  break;
                }
              }
            } else {
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –∫–æ–º–º—É–Ω–∞–ª–∫–æ–π (–µ—Å—Ç—å "–∫–æ–º.")
              const isCommunal = /–∫–æ–º\.?/i.test(lastPart);
              
              if (isCommunal) {
                // –≠—Ç–æ –∫–æ–º–º—É–Ω–∞–ª–∫–∞, –∏—â–µ–º –Ω–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã
                const roomNumber = extractRoomNumber(lastPart);
                
                if (roomNumber) {
                  // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å –±—É–∫–≤–æ–π, –ø–æ—ç—Ç–æ–º—É —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏)
                  // –ï—Å–ª–∏ –∏—Å–∫–æ–º—ã–π –Ω–æ–º–µ—Ä –±–µ–∑ –±—É–∫–≤—ã, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä–æ–≤—É—é —á–∞—Å—Ç—å
                  const roomNumberDigits = roomNumber.replace(/\D/g, '');
                  const searchNumberDigits = apartmentNumber.replace(/\D/g, '');
                  
                  // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º: –ª–∏–±–æ –ø–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (—Å –±—É–∫–≤–æ–π), –ª–∏–±–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ü–∏—Ñ—Ä
                  if (roomNumber === apartmentNumber || roomNumberDigits === searchNumberDigits) {
                    foundItem = item;
                    break;
                  }
                }
              } else {
              // –û–±—ã—á–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞, –∏—â–µ–º –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã
              const lastPartNumber = extractFirstNumber(lastPart);
              
              // –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—è—è —á–∞—Å—Ç—å —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã
              if (lastPartNumber === apartmentNumber) {
                foundItem = item;
                break;
              }
              
              // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç, –µ—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π - —ç—Ç–æ –±—É–∫–≤–∞/–∫–æ—Ä–ø—É—Å
              if (addressParts.length >= 2) {
                const secondLastPart = addressParts[addressParts.length - 2];
                
                // –ï—Å–ª–∏ –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω–∏–π - —ç—Ç–æ –±—É–∫–≤–∞ (–æ–¥–Ω–∞ –±—É–∫–≤–∞), –∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π - –Ω–æ–º–µ—Ä
                if (secondLastPart.length === 1 && /^[–∞-—èa-z]$/i.test(secondLastPart) && lastPartNumber === apartmentNumber) {
                  foundItem = item;
                  break;
                }
              }
              }
            }
          }

          if (!foundItem) {
            showToast(`‚ùå –ö–≤–∞—Ä—Ç–∏—Ä–∞/–∫–æ–º–Ω–∞—Ç–∞ ${apartmentNumber} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`, 3000, '#a33');
            return;
          }

          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —á—Ç–æ –±—ã–ª–æ –Ω–∞–π–¥–µ–Ω–æ (–∫–≤–∞—Ä—Ç–∏—Ä–∞ –∏–ª–∏ –∫–æ–º–Ω–∞—Ç–∞)
          const foundTitle = foundItem.querySelector('div._taskTitle_36r29_45')?.textContent.trim() || '';
          const foundLastPart = foundTitle.split(',').pop() || '';
          const isFoundSlashFormat = /\d+\/\d+/.test(foundLastPart);
          const isFoundCommunal = /–∫–æ–º\.?/i.test(foundLastPart);
          const foundLabel = (isFoundSlashFormat || isFoundCommunal) ? '–∫–æ–º–Ω–∞—Ç–∞' : '–∫–≤–∞—Ä—Ç–∏—Ä–∞';

          // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
          foundItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
          await new Promise(r => setTimeout(r, 300));

          // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç (–¥–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å)
          const originalStyle = foundItem.style.cssText;
          foundItem.style.cssText = `
            ${originalStyle}
            border: 3px solid #007acc !important;
            background: rgba(0, 122, 204, 0.1) !important;
            box-shadow: 0 0 10px rgba(0, 122, 204, 0.5) !important;
            transition: all 0.3s ease !important;
          `;

          // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
          setTimeout(() => {
            foundItem.style.cssText = originalStyle;
          }, 3000);

          showToast(`‚úÖ –ù–∞–π–¥–µ–Ω–∞ ${foundLabel} ${apartmentNumber}`, 3000, '#2a7');
          return;
        }
        
        if (lowerTranscript.includes('—Ä–∞–∑—Ä—è–¥') || lowerTranscript.includes('—Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å')) {
          // –ù–∞—Ö–æ–¥–∏–º —á–∏—Å–ª–æ: —Ü–∏—Ñ—Ä–∞ –∏–ª–∏ —Å–ª–æ–≤–æ
          const numMatch = lowerTranscript.match(/(\d|–Ω–æ–ª—å|–æ–¥–∏–Ω|–¥–≤–∞|—Ç—Ä–∏|—á–µ—Ç—ã—Ä–µ|–ø—è—Ç—å|—à–µ—Å—Ç—å|—Å–µ–º—å|–≤–æ—Å–µ–º—å|–¥–µ–≤—è—Ç—å)/i);
          if (!numMatch) {
            showToast('‚ùå –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞ —Ü–∏—Ñ—Ä–∞ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏', 3000, '#a33');
            return;
          }
          const numStr = numMatch[1].toLowerCase();
          let newCapacity;
          if (/^\d$/.test(numStr)) {
            newCapacity = parseInt(numStr);
          } else if (numStr in russianNumbers) {
            newCapacity = russianNumbers[numStr];
          } else {
            showToast('‚ùå –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞ —Ü–∏—Ñ—Ä–∞ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏', 3000, '#a33');
            return;
          }

          if (newCapacity < 4 || newCapacity > 9) {
            showToast('‚ùå –†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 4 –¥–æ 9', 3000, '#a33');
            return;
          }

          // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª–µ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏ –ø–æ —Ç–µ–∫—Å—Ç—É "–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å"
          // –ò—â–µ–º —á–µ—Ä–µ–∑ En —Å name="capacity_match" –∏–ª–∏ –ø–æ —Ç–µ–∫—Å—Ç—É
          let capacityMatchEn = document.querySelector('En[name="capacity_match"]') ||
                                document.querySelector('en[name="capacity_match"]') ||
                                document.querySelector('[name="capacity_match"]');
          
          // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ name, –∏—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É "–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å"
          if (!capacityMatchEn) {
            // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º div —Å –∫–ª–∞—Å—Å–æ–º _selectField_1ydb5_1 –∏–ª–∏ _selectField_1mapt_1, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å -"
            const selectFields = document.querySelectorAll('div._selectField_1ydb5_1, div._selectField_1mapt_1');
            
            for (const el of selectFields) {
              const text = el.textContent || '';
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º–µ–Ω–Ω–æ "–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å -" —Å —á–∏—Å–ª–æ–º
              const hasCapacityPattern = text.match(/–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å\s*-\s*\d+/i);
              
              if (hasCapacityPattern) {
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ "–¢–∏–ø –ü–£" –∏–ª–∏ –¥—Ä—É–≥–æ–π —ç–ª–µ–º–µ–Ω—Ç
                const labelText = el.querySelector('label span')?.textContent || '';
                if (labelText.includes('–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å') && labelText.match(/–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å\s*-\s*\d+/i)) {
                  capacityMatchEn = el;
                  break;
                }
              }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ _selectField, –∏—â–µ–º –ø–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º
            if (!capacityMatchEn) {
              const allElements = document.querySelectorAll('En, en, div, label, span');
              
              for (const el of allElements) {
                const text = el.textContent || '';
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º–µ–Ω–Ω–æ "–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å -" —Å —á–∏—Å–ª–æ–º
                const hasCapacityPattern = text.match(/–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å\s*-\s*\d+/i);
                
                if (hasCapacityPattern) {
                  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ "–¢–∏–ø –ü–£" –∏–ª–∏ –¥—Ä—É–≥–æ–π —ç–ª–µ–º–µ–Ω—Ç
                  const labelText = el.querySelector('label span')?.textContent || el.textContent || '';
                  if (labelText.includes('–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å') && labelText.match(/–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å\s*-\s*\d+/i) && 
                      !labelText.includes('–¢–∏–ø –ü–£') && !labelText.includes('–ú–µ—Ä–∫—É—Ä–∏–π')) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤–Ω—É—Ç—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Å–æ–º _value_8fpl2_13 –∏–ª–∏ _selectField_1ydb5_1
                    const hasValue = el.querySelector('div._value_8fpl2_13') || 
                                    el.querySelector('div._selectField_1ydb5_1') ||
                                    el.querySelector('div._value_1oihn_13') ||
                                    el.querySelector('div._selectField_1mapt_1');
                    const hasClass = el.classList.contains('_selectField_1ydb5_1') || 
                                    el.classList.contains('_selectField_1mapt_1');
                    
                    if (hasValue || hasClass) {
                      capacityMatchEn = el;
                      break;
                    }
                  }
                }
              }
            }
          }
          
          if (!capacityMatchEn) {
            showToast('‚ùå –ü–æ–ª–µ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 3000, '#a33');
            return;
          }

          // –ò—â–µ–º div —Å –∫–ª–∞—Å—Å–æ–º _selectField_1ydb5_1 –∏–ª–∏ _selectField_1mapt_1 (–æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
          let capacityMatchDiv = capacityMatchEn.querySelector('div._selectField_1ydb5_1') ||
                                 capacityMatchEn.querySelector('div._selectField_1mapt_1');
          
          // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∞–º —ç–ª–µ–º–µ–Ω—Ç, –µ—Å–ª–∏ –æ–Ω –∏–º–µ–µ—Ç –Ω—É–∂–Ω—ã–π –∫–ª–∞—Å—Å
          if (!capacityMatchDiv) {
            if (capacityMatchEn.classList.contains('_selectField_1ydb5_1') || 
                capacityMatchEn.classList.contains('_selectField_1mapt_1')) {
              capacityMatchDiv = capacityMatchEn;
            } else {
              capacityMatchDiv = capacityMatchEn;
            }
          }
          
          // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—É—â—É—é —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å –∏–∑ <b> —Ç–µ–≥–∞ –≤–Ω—É—Ç—Ä–∏ <span> —Å —Ç–µ–∫—Å—Ç–æ–º "–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å -"
          let currentCapacity = null;
          
          // –ò—â–µ–º span, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å -"
          const spans = capacityMatchDiv.querySelectorAll('span, label span');
          
          for (const span of spans) {
            const spanText = span.textContent || '';
            
            if (spanText.includes('–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å') && spanText.includes('-')) {
              // –ò—â–µ–º <b> —Ç–µ–≥ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ span
              const bTag = span.querySelector('b');
              
              if (bTag) {
                const bText = bTag.textContent.trim();
                const num = parseInt(bText, 10);
                if (!isNaN(num) && num >= 4 && num <= 9) {
                  currentCapacity = num;
                  break;
                }
              }
              
              // –ï—Å–ª–∏ <b> –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –∏–∑ —Ç–µ–∫—Å—Ç–∞ span
              if (!currentCapacity) {
                const match = spanText.match(/–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å\s*-\s*(\d+)/i);
                if (match) {
                  const num = parseInt(match[1], 10);
                  if (!isNaN(num) && num >= 4 && num <= 9) {
                    currentCapacity = num;
                    break;
                  }
                }
              }
            }
          }
          
          // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ span, –ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –∏–∑ –≤—Å–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
          if (currentCapacity === null) {
            const capacityText = capacityMatchDiv.textContent.trim();
            const capacityMatch = capacityText.match(/–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å\s*-\s*(\d+)/i);
            if (capacityMatch) {
              const num = parseInt(capacityMatch[1], 10);
              if (!isNaN(num) && num >= 4 && num <= 9) {
                currentCapacity = num;
              }
            }
          }
          
          if (currentCapacity === null) {
            showToast('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—É—â—É—é —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å', 3000, '#a33');
            return;
          }
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å
          if (currentCapacity === newCapacity) {
            // –†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
            const valueEl = capacityMatchEn.querySelector('div._value_8fpl2_13, div._value_1oihn_13') ||
                           capacityMatchDiv.querySelector('div._value_8fpl2_13, div._value_1oihn_13');
            if (valueEl && valueEl.textContent.trim() === '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
              showToast('‚úÖ –†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç', 3000, '#2a7');
              return;
            }
            // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç", –Ω–æ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å
            showToast('‚úÖ –†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç', 3000, '#2a7');
            return;
          }

          // –†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å
          // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Å–æ–º _value_8fpl2_13 –∏–ª–∏ _value_1oihn_13, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
          let complianceValueEl = null;
          
          // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –≤–Ω—É—Ç—Ä–∏ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
          const allValueElements = capacityMatchEn.querySelectorAll('div._value_8fpl2_13, div._value_1oihn_13');
          for (const valueEl of allValueElements) {
            if (valueEl.textContent.trim() === '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç' || valueEl.textContent.trim() === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
              complianceValueEl = valueEl;
              break;
            }
          }

          // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –≤–Ω—É—Ç—Ä–∏, –∏—â–µ–º –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
          if (!complianceValueEl) {
            let parent = capacityMatchEn.parentElement;
            let searchDepth = 0;
            while (parent && searchDepth < 5) {
              const values = parent.querySelectorAll('div._value_8fpl2_13, div._value_1oihn_13');
              for (const valueEl of values) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ä—è–¥–æ–º —Å –ø–æ–ª–µ–º —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏
                const valueText = valueEl.textContent.trim();
                if ((valueText === '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç' || valueText === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') &&
                    parent.textContent.includes('–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å')) {
                  complianceValueEl = valueEl;
                  break;
                }
              }
              if (complianceValueEl) break;
              parent = parent.parentElement;
              searchDepth++;
            }
          }

          // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –∏—â–µ–º –≤–æ –≤—Å–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ —Ä—è–¥–æ–º —Å —Ç–µ–∫—Å—Ç–æ–º "–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å"
          if (!complianceValueEl) {
            const allValues = document.querySelectorAll('div._value_8fpl2_13, div._value_1oihn_13');
            for (const valueEl of allValues) {
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å —Ç–µ–∫—Å—Ç–æ–º "–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å"
              const container = valueEl.closest('div, En, en');
              if (container && container.textContent && container.textContent.includes('–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å')) {
                const valueText = valueEl.textContent.trim();
                if (valueText === '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç' || valueText === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
                  complianceValueEl = valueEl;
                  break;
                }
              }
            }
          }

          if (!complianceValueEl) {
            showToast('‚ùå –≠–ª–µ–º–µ–Ω—Ç "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" –Ω–µ –Ω–∞–π–¥–µ–Ω', 3000, '#a33');
            return;
          }

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
          if (complianceValueEl.textContent.trim() === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
            // –£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç", –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ fact_capacity
            let factCapacityInput = document.querySelector('input#fact_capacity') ||
                                   document.querySelector('input[name="fact_capacity"]');
            
            if (factCapacityInput && factCapacityInput.offsetParent !== null) {
              await setReactInputValue('input#fact_capacity', newCapacity.toString());
              showToast(`‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å: ${newCapacity}`, 3000, '#2a7');
              return;
            } else {
              // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—è
              for (let i = 0; i < 20; i++) {
                await new Promise(r => setTimeout(r, 100));
                factCapacityInput = document.querySelector('input#fact_capacity') ||
                                   document.querySelector('input[name="fact_capacity"]');
                if (factCapacityInput && factCapacityInput.offsetParent !== null) break;
              }
              
              if (factCapacityInput && factCapacityInput.offsetParent !== null) {
                await setReactInputValue('input#fact_capacity', newCapacity.toString());
                showToast(`‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å: ${newCapacity}`, 3000, '#2a7');
                return;
              } else {
                showToast('‚ùå –ü–æ–ª–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏ –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å', 3000, '#a33');
                return;
              }
            }
          }

          // –ö–ª–∏–∫–∞–µ–º –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏
          complianceValueEl.click();
          await new Promise(r => setTimeout(r, 400));

          // –ù–∞—Ö–æ–¥–∏–º –ø–∞–Ω–µ–ª—å —Å –æ–ø—Ü–∏—è–º–∏ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
          let panel = null;
          for (let i = 0; i < 15; i++) {
            await new Promise(r => setTimeout(r, 100));
            panel = document.querySelector('._panel_1q4rd_19.slide-up-enter-done') ||
                    document.querySelector('._panel_1q4rd_19') ||
                    document.querySelector('._panel_1i7mm_19.slide-up-enter-done') ||
                    document.querySelector('._panel_1i7mm_19');
            if (panel) break;
          }
          
          if (!panel) {
            showToast('‚ùå –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 3000, '#a33');
            return;
          }

          // –ò—â–µ–º –æ–ø—Ü–∏—é "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" —Å –∫–ª–∞—Å—Å–æ–º _option_8fpl2_78
          let notCompliantOption = null;
          const allOptions = panel.querySelectorAll('._option_8fpl2_78, ._option_1oihn_78, [class*="option"]');
          for (const option of allOptions) {
            const span = option.querySelector('span');
            const text = span ? span.textContent.trim() : option.textContent.trim();
            if (text === '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç') {
              notCompliantOption = option;
              break;
            }
          }
          
          // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ —Ç–µ–∫—Å—Ç—É, –ø—Ä–æ–±—É–µ–º –ø–æ nth-child (–≤—Ç–æ—Ä–∞—è –æ–ø—Ü–∏—è –æ–±—ã—á–Ω–æ "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç")
          if (!notCompliantOption) {
            notCompliantOption = panel.querySelector('._option_8fpl2_78:nth-child(2)') ||
                                panel.querySelector('._option_1oihn_78:nth-child(2)');
          }

          if (!notCompliantOption) {
            showToast('‚ùå –û–ø—Ü–∏—è "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 3000, '#a33');
            return;
          }

          // –ö–ª–∏–∫–∞–µ–º –Ω–∞ –æ–ø—Ü–∏—é "–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"
          notCompliantOption.click();
          await new Promise(r => setTimeout(r, 400));

          // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—è fact_capacity
          let factCapacityInput = null;
          for (let i = 0; i < 30; i++) {
            await new Promise(r => setTimeout(r, 100));
            factCapacityInput = document.querySelector('input#fact_capacity') ||
                               document.querySelector('input[name="fact_capacity"]');
            if (factCapacityInput && factCapacityInput.offsetParent !== null) break;
          }

          if (factCapacityInput && factCapacityInput.offsetParent !== null) {
            await setReactInputValue('input#fact_capacity', newCapacity.toString());
            showToast(`‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å: ${newCapacity}`, 3000, '#2a7');
            return;
          } else {
            showToast('‚ùå –ü–æ–ª–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏ –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å', 3000, '#a33');
            return;
          }
        } else {
          // –û–±—ã—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π
          const digits=transcriptTotal.replace(/\D/g,'');
          if(!digits){ showToast('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ü–∏—Ñ—Ä—ã',3000,'#a33'); return; }

          let selector,label;
          if(isDualTariff){ selector=nextIsDay?daySelector:nightSelector; label=nextIsDay?'–¥–µ–Ω—å':'–Ω–æ—á—å'; }
          else{ selector=daySelector; label='–¥–µ–Ω—å'; }

          const success=await setReactInputValue(selector,digits);
          if(!success){ showToast(`‚ùå –ü–æ–ª–µ ${label} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ`,3000,'#a33'); return; }

          if(isDualTariff) nextIsDay=!nextIsDay;
          showToast(`‚úÖ –í—Å—Ç–∞–≤–ª–µ–Ω—ã –ø–æ–∫–∞–∑–∞–Ω–∏—è (${label}): ${digits}`,3000,label==='–¥–µ–Ω—å'?'#007acc':'#673ab7');
        }
      },finalizeDelay);
    }
  });

  // –°–æ–∑–¥–∞–µ–º MutationObserver —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
  function initObserver() {
    if (!document.body) {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initObserver);
        return;
      }
      // –ï—Å–ª–∏ body –≤—Å–µ –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
      setTimeout(initObserver, 100);
      return;
    }
    
    const observer = new MutationObserver(() => { 
      const hasDay = document.querySelector(daySelector); 
      const hasNight = document.querySelector(nightSelector); 
      const dual = !!(hasDay && hasNight); 
      if (dual !== lastDetectedTariff) detectTariffMode(true); 
    });
    observer.observe(document.body, { childList: true, subtree: true });
  }
  
  initObserver();

})();