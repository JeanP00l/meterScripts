# Скрипты инструменталки для автоматизации учета показаний счетчиков

Набор пользовательских скриптов (userscripts) для автоматизации работы с веб-приложением по учету и проверке показаний счетчиков. Скрипты предназначены для ускорения процесса заполнения форм, ввода данных и управления информацией о счетчиках.

## Описание

Проект представляет собой набор независимых пользовательских скриптов, которые работают в браузере и автоматизируют рутинные операции при работе с системой учета показаний счетчиков. Все скрипты написаны на чистом JavaScript без внешних зависимостей и используют только нативные браузерные API.

## Технологии

- **JavaScript (ES6+)** - основной язык разработки
- **Web Speech API** - для распознавания речи
- **DOM API** - для взаимодействия с элементами страницы
- **LocalStorage API** - для сохранения настроек пользователя
- **MutationObserver API** - для отслеживания изменений DOM

## Требования

- Браузер с поддержкой пользовательских скриптов (Tampermonkey, Violentmonkey и т.д.)
- Google Chrome (рекомендуется для Web Speech API)
- Доступ к сайту meter.printecs.com

## Установка
- Установить [User JavaScript and CSS](https://chromewebstore.google.com/detail/user-javascript-and-css/nbhcbdghjpllgmfilhnhkllmkecfmpld)
- Зайти в настройку расширений
- 
  <img width="331" height="576" alt="extensionJS" src="https://github.com/user-attachments/assets/cee2a36a-67d3-4751-acca-f8adccf03f97" />

- Найти User JavaScript and CSS и зайти в "Сведения"

  <img width="405" height="211" alt="image" src="https://github.com/user-attachments/assets/92fd594f-3207-4b7c-8055-92de7d178074" />

- Включить "Разрешить пользовательские скрипты"

  <img width="678" height="336" alt="image" src="https://github.com/user-attachments/assets/929312d6-a770-4d65-8748-5dac5c560e1c" />

- Перейти в "Параметры расширений"

  <img width="683" height="212" alt="image" src="https://github.com/user-attachments/assets/d34b7cbd-160e-4ab9-9ec4-693c77b86805" />

- Нажать на кнопку настройки слева

  <img width="275" height="217" alt="image" src="https://github.com/user-attachments/assets/d8417696-1d62-44a6-9589-f05ce1804955" />

- Выбрать "Загрузить JSON"

  <img width="321" height="265" alt="image" src="https://github.com/user-attachments/assets/c7d3b826-b443-4b53-bc48-1297f8349901" />

- Выбрать скачанный json файл из [релизов](https://github.com/JeanP00l/meterScripts/releases) и согласиться с изменениями

Готово.



## Скрипты

### 1. Менеджер общей панели настроек

**Файл**: `Менеджер общей панели настроек.txt`

Централизованная панель управления всеми скриптами. Предоставляет единый интерфейс для настройки всех модулей, позволяет перетаскивать панель по экрану, сворачивать и разворачивать её. Сохраняет позицию панели и настройки между сессиями.

**Основные функции:**
- Регистрация секций настроек для каждого скрипта
- Управление отображением панели (сворачивание/разворачивание)
- Перетаскивание панели по экрану
- Сохранение позиции панели в localStorage

### 2. Автозаполнение

**Файл**: `Автозаполнение.txt`

Автоматизирует процесс заполнения форм при проверке счетчиков. Позволяет быстро переходить между записями, автоматически заполнять повторяющиеся данные и управлять шаблонами.

**Основные функции:**
- Автоматический переход между записями (следующая/предыдущая)
- Автоматическая инкрементация номеров пломб
- Управление шаблонами антимагнитных пломб
- Блок быстрого выбора ДЮП/ГЕП с кнопкой "Просрочен"
- Автоматическое обновление даты следующей поверки при изменении даты предыдущей поверки
- Настраиваемые горячие клавиши (по умолчанию `/`)

### 3. Голосовой набор показаний

**Файл**: `Голосовой набор показаний.txt`

Позволяет вводить данные через распознавание речи, значительно ускоряя процесс заполнения форм.

**Основные функции:**
- Распознавание показаний счетчиков (дневной/ночной тариф)
- Распознавание типа счетчика (CE 101, CE 102M, Меркурий и др.)
- Распознавание года выпуска ("выпуск 2015")
- Распознавание номеров пломб ("пломба 85") с умной логикой дополнения/замены
- Поиск адресов по номеру квартиры ("адрес 38")
- Изменение разрядности счетчика ("разрядность 7")
- Настраиваемые горячие клавиши для активации (по умолчанию `F2`)

**Кодовые слова:**
- Числа - для ввода показаний счетчика
- "Счетчик [тип]" - для изменения типа счетчика
- "Выпуск [год]" - для проверки и изменения года изготовления
- "Пломба [номер]" - для дополнения или замены номера пломбы (работает с шаблоном, поддерживает русские числительные)
- "Адрес [номер]" - для поиска квартиры по номеру
- "Разрядность [число]" - для изменения разрядности счетчика

### 4. Загрузка фото

**Файл**: `Загрузка фото.txt`

Упрощает процесс загрузки фотографий счетчиков через drag-and-drop.

**Основные функции:**
- Глобальный drag-and-drop для загрузки изображений
- Автоматическое определение контейнера для загрузки фото
- Поддержка множественной загрузки изображений
- Работает автоматически без дополнительных настроек

### 5. Подсчет результатов

**Файл**: `Подсчет результатов.txt`

Автоматически подсчитывает количество счетчиков и загруженных записей.

**Основные функции:**
- Автоматический обход всех адресов и квартир
- Подсчет общего количества счетчиков
- Подсчет загруженных счетчиков (по статусу)
- Сохранение результатов в localStorage
- Отображение результатов в панели настроек

## Особенности работы с React

Целевое приложение построено на React, поэтому скрипты используют специальные функции для корректной работы с React-компонентами:

- `setReactInputValue()` - для работы с обычными input/textarea полями
- `setReactCheckboxValue()` - для работы с checkbox полями
- `setDateValue()` - для работы с полями типа `input[type="date"]`
- Работа с React `_valueTracker` для корректного отслеживания изменений
- Правильная диспатча событий с `bubbles: true`
- Retry-логика для асинхронных обновлений состояния React

## Настройка

Все настройки доступны через панель "Настройки скриптов", которая появляется на странице после установки скриптов. Горячие клавиши настраиваются индивидуально для каждого скрипта. Шаблоны антимагнитной пломбы управляются через модальное окно в разделе "Автозаполнение".

## Версия

**Текущая версия**: 0.10.3

### История версий

**v0.10.3** (2025-01-27):
- Добавлен шаблон заполнения номера пломбы (максимум 5 цифр)
- Улучшена функция обработки кодового слова "Пломба":
  - Добавлена поддержка распознавания русских числительных (например, "пломба шесть")
  - Однозначные числа автоматически дополняются нулем до двухзначного формата
  - Умная логика дополнения/замены: если сумма цифр шаблона и произнесенного числа ≤ 5, дополняет в конец; если > 5, заменяет последние цифры шаблона
  - Toast-уведомление теперь показывает полный номер пломбы после установки

**v0.10.2** (2025-01-27):
- Добавлена автоматическая проверка обновлений через GitHub Releases API
- Добавлено уведомление о новой версии в правом верхнем углу
- Добавлена кнопка "Проверить обновления" в менеджере настроек
- При обнаружении обновления: возможность скачать JSON и открыть страницу релиза

**v0.10.1** (2025-01-27):
- Исправлена ошибка исчисления поверок: дата следующей поверки теперь устанавливается на день раньше, чем дата предыдущей поверки + 16 лет

**v0.10.0**:
- Первая версия с полной документацией
